<!doctype html>
<html lang="en-us">
  <head>
    <title>Java反射 // Sp(act)rum</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="冯雪洋" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://shery-long.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Java反射"/>
<meta name="twitter:description" content="反射机制概述 反射被视为动态语言的关键，反射机制允许程序在执行期借助于Reflection API取得任何类的内部信息，并能直接操作任意对象的内部属性及方法  加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象(一个类只有一个Class对象)，这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。  动态语言 在运行时可以改变其结构的语言：例如新的函数、对象、甚至代码可以被引进，已有的函数可以被删除或是其他结构上的变化。
 在运行时代码可以根据某些条件改变自身结构 *  如Object-C、C#、JavaScript、PHP、Python、Erlang
静态语言 与动态语言相对应的，运行时结构不可变的语言就是静态语言。如Java、C、C&#43;&#43;
 Java不是动态语言，但是Java有一定的动态性，我们可以利用反射机制、字节码操作获得类似动态语言的特性   Java反射机制提供的功能
&gt;在运行时判断任意一个对象所属的类 &gt;在运行时构造任意一个类的对象 &gt;在运行时判断任意一个类所具有的成员变量和方法 &gt;在运行时获取泛型信息 &gt;在运行时调用任意一个对象的成员变量和方法 &gt;在运行时处理注解 &gt;生成动态代理  @Test public void test() throws Exception { //通过反射方式获取类，构造器，并创建对象  Class&lt;?&gt; personClass = Class.forName(&#34;Person&#34;); Object o = personClass.getDeclaredConstructor(String.class, int.class, boolean.class).newInstance(&#34;Tom&#34;, 24, true); Person p = (Person) o; //通过反射调用方法  System.out.println(personClass.getDeclaredMethod(&#34;toString&#34;).invoke(p)); // Person{name=&#39;Tom&#39;, age=24, isMale=true, privateMember=&#39;can not access&#39;}  //通过反射修改属性值  personClass.getField(&#34;name&#34;).set(p, &#34;Jerry&#34;); System.out.println(personClass.getDeclaredMethod(&#34;toString&#34;).invoke(p)); // Person{name=&#39;Jerry&#39;, age=24, isMale=true, privateMember=&#39;can not access&#39;}  //通过反射可以调用类的私有结构  Field privateMember = personClass."/>

    <meta property="og:title" content="Java反射" />
<meta property="og:description" content="反射机制概述 反射被视为动态语言的关键，反射机制允许程序在执行期借助于Reflection API取得任何类的内部信息，并能直接操作任意对象的内部属性及方法  加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象(一个类只有一个Class对象)，这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。  动态语言 在运行时可以改变其结构的语言：例如新的函数、对象、甚至代码可以被引进，已有的函数可以被删除或是其他结构上的变化。
 在运行时代码可以根据某些条件改变自身结构 *  如Object-C、C#、JavaScript、PHP、Python、Erlang
静态语言 与动态语言相对应的，运行时结构不可变的语言就是静态语言。如Java、C、C&#43;&#43;
 Java不是动态语言，但是Java有一定的动态性，我们可以利用反射机制、字节码操作获得类似动态语言的特性   Java反射机制提供的功能
&gt;在运行时判断任意一个对象所属的类 &gt;在运行时构造任意一个类的对象 &gt;在运行时判断任意一个类所具有的成员变量和方法 &gt;在运行时获取泛型信息 &gt;在运行时调用任意一个对象的成员变量和方法 &gt;在运行时处理注解 &gt;生成动态代理  @Test public void test() throws Exception { //通过反射方式获取类，构造器，并创建对象  Class&lt;?&gt; personClass = Class.forName(&#34;Person&#34;); Object o = personClass.getDeclaredConstructor(String.class, int.class, boolean.class).newInstance(&#34;Tom&#34;, 24, true); Person p = (Person) o; //通过反射调用方法  System.out.println(personClass.getDeclaredMethod(&#34;toString&#34;).invoke(p)); // Person{name=&#39;Tom&#39;, age=24, isMale=true, privateMember=&#39;can not access&#39;}  //通过反射修改属性值  personClass.getField(&#34;name&#34;).set(p, &#34;Jerry&#34;); System.out.println(personClass.getDeclaredMethod(&#34;toString&#34;).invoke(p)); // Person{name=&#39;Jerry&#39;, age=24, isMale=true, privateMember=&#39;can not access&#39;}  //通过反射可以调用类的私有结构  Field privateMember = personClass." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shery-long.github.io/post/javareflection/" />
<meta property="article:published_time" content="2022-10-02T15:57:12+08:00" />
<meta property="article:modified_time" content="2022-10-02T15:57:12+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://shery-long.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="冯雪洋" /></a>
      <h1>Sp(act)rum</h1>
      <p>这个人很懒，什么介绍都没留下</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/Sherry-long" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://space.bilibili.com/13547597" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link">
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Java反射</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Oct 2, 2022
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          5 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <h3 id="反射机制概述">反射机制概述</h3>
<h5 id="反射被视为动态语言的关键反射机制允许程序在执行期借助于reflection-api取得任何类的内部信息并能直接操作任意对象的内部属性及方法">反射被视为动态语言的关键，反射机制允许程序在执行期借助于Reflection API取得任何类的内部信息，并能直接操作任意对象的内部属性及方法</h5>
<ul>
<li>加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象(一个类只有一个Class对象)，这个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。</li>
</ul>
<h4 id="动态语言">动态语言</h4>
<p>在运行时可以改变其结构的语言：例如新的函数、对象、甚至代码可以被引进，已有的函数可以被删除或是其他结构上的变化。</p>
<ul>
<li>在运行时代码可以根据某些条件改变自身结构 *</li>
</ul>
<p>如Object-C、C#、JavaScript、PHP、Python、Erlang</p>
<h4 id="静态语言">静态语言</h4>
<p>与动态语言相对应的，运行时结构不可变的语言就是静态语言。如Java、C、C++</p>
<ul>
<li>Java不是动态语言，但是Java有一定的动态性，我们可以利用反射机制、字节码操作获得类似动态语言的特性</li>
</ul>
<hr>
<p>Java反射机制提供的功能</p>
<pre><code>&gt;在运行时判断任意一个对象所属的类
&gt;在运行时构造任意一个类的对象
&gt;在运行时判断任意一个类所具有的成员变量和方法
&gt;在运行时获取泛型信息
&gt;在运行时调用任意一个对象的成员变量和方法
&gt;在运行时处理注解
&gt;生成动态代理
</code></pre><hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">	<span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        <span style="color:#75715e">//通过反射方式获取类，构造器，并创建对象
</span><span style="color:#75715e"></span>        Class<span style="color:#f92672">&lt;?&gt;</span> personClass <span style="color:#f92672">=</span> Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Person&#34;</span><span style="color:#f92672">);</span>
        Object o <span style="color:#f92672">=</span> personClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredConstructor</span><span style="color:#f92672">(</span>String<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">boolean</span><span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">).</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tom&#34;</span><span style="color:#f92672">,</span> 24<span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
        Person p <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Person<span style="color:#f92672">)</span> o<span style="color:#f92672">;</span>

        <span style="color:#75715e">//通过反射调用方法
</span><span style="color:#75715e"></span>        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>personClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;toString&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>p<span style="color:#f92672">));</span>
        <span style="color:#75715e">// Person{name=&#39;Tom&#39;, age=24, isMale=true, privateMember=&#39;can not access&#39;}
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">//通过反射修改属性值
</span><span style="color:#75715e"></span>        personClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getField</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Jerry&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>personClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;toString&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>p<span style="color:#f92672">));</span>
        <span style="color:#75715e">// Person{name=&#39;Jerry&#39;, age=24, isMale=true, privateMember=&#39;can not access&#39;}
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">//通过反射可以调用类的私有结构
</span><span style="color:#75715e"></span>        Field privateMember <span style="color:#f92672">=</span> personClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredField</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;privateMember&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#75715e">//修改权限
</span><span style="color:#75715e"></span>        privateMember<span style="color:#f92672">.</span><span style="color:#a6e22e">setAccessible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
        privateMember<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;can access&#34;</span><span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>personClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;toString&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>p<span style="color:#f92672">));</span>
        <span style="color:#75715e">// Person{name=&#39;Jerry&#39;, age=24, isMale=true, privateMember=&#39;can access&#39;}
</span><span style="color:#75715e"></span>
        Method privateMethod <span style="color:#f92672">=</span> personClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;privateMethod&#34;</span><span style="color:#f92672">);</span>
        privateMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">setAccessible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
        privateMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>p<span style="color:#f92672">);</span>
        <span style="color:#75715e">// this is a private method
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> age<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> isMale<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String privateMember <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;can not access&#34;</span><span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Person</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#f92672">}</span>


    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Person</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> age<span style="color:#f92672">,</span> <span style="color:#66d9ef">boolean</span> isMale<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">age</span> <span style="color:#f92672">=</span> age<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isMale</span> <span style="color:#f92672">=</span> isMale<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Person{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;name=&#39;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, age=&#34;</span> <span style="color:#f92672">+</span> age <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, isMale=&#34;</span> <span style="color:#f92672">+</span> isMale <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, privateMember=&#39;&#34;</span> <span style="color:#f92672">+</span> privateMember <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">show</span><span style="color:#f92672">(){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">());</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">privateMethod</span><span style="color:#f92672">(){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;this is a private method&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><hr>
<h3 id="qa">Q&amp;A</h3>
<ul>
<li>通过直接new的方式或反射的方式都可以调用公共结构，开发中使用哪个？</li>
</ul>
<pre><code>一般使用new

当我们需要编写的代码具有一定的动态性时，(比如编译时不确定要造哪个类的对象)就使用反射的方式

</code></pre><ul>
<li>反射机制与面向对象中的封装性是不是矛盾？如何看待这两个技术？</li>
</ul>
<pre><code>不矛盾。
</code></pre><hr>
<h3 id="获取class实例的方式">获取Class实例的方式</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">	<span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test1</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> ClassNotFoundException <span style="color:#f92672">{</span>
        <span style="color:#75715e">//调用运行时类的属性
</span><span style="color:#75715e"></span>        Class clazz <span style="color:#f92672">=</span> Person<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">;</span>

        <span style="color:#75715e">//通过运行时类的实例
</span><span style="color:#75715e"></span>        Person p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Person<span style="color:#f92672">();</span>
        Class clazz1 <span style="color:#f92672">=</span> p<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">();</span>

        <span style="color:#75715e">//Class.forName  最常用
</span><span style="color:#75715e"></span>        Class clazz2 <span style="color:#f92672">=</span> Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Person&#34;</span><span style="color:#f92672">);</span>

        <span style="color:#75715e">//使用类加载器 ClassLoader
</span><span style="color:#75715e"></span>        ClassLoader classLoader <span style="color:#f92672">=</span> rflTest<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">();</span>
        Class clazz3 <span style="color:#f92672">=</span> classLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">loadClass</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Person&#34;</span><span style="color:#f92672">);</span>
        

    <span style="color:#f92672">}</span>
</code></pre></div><h3 id="哪些类型可以有class对象">哪些类型可以有Class对象</h3>
<pre><code>&gt;class:
	外部类，成员(成员内部类，静态内部类)，局部内部类，匿名内部类
&gt;interface:接口
&gt;[]:数组
&gt;enum:枚举
&gt;annotation:注解@interface
&gt;基本数据类型
&gt;void
</code></pre><hr>
<hr>
<h3 id="类的加载过程">类的加载过程</h3>
<ul>
<li>当程序主动使用某个类时，如果该类还未被加载到内存中，则系统会通过如下三个步骤来对该类进行初始化</li>
</ul>
<pre><code>类的加载(Load):将类的class文件读入内存，并为之创建一个Class对象。此过程由类加载器完成


类的链接(Link):将类的二进制数据合并到JRE中

类的初始化(Initialize):JVM负责对类进行初始化
</code></pre><h3 id="类的加载器">类的加载器</h3>
<p>写好的代码 -&gt; javac编译 -&gt; 字节码文件(.class) -&gt;     (源码阶段)</p>
<p>由类加载器(ClassLoader)加载进内存 -&gt; Class类对象(成员变量Field[] fields，</p>
<pre><code>                                             构造方法Constructor[] constructors，
											 
                                             成员方法Methods[] methods)用来描述.class字节码文件内容 -&gt;    (Class类对象阶段)
											 
                                             创建对象
</code></pre>
<h5 id="类加载器的作用将class文件字节码内容加载到内存中并将这些静态数据转换成方法区的运行时数据结构然后在堆中生成一个代表这个类的class对象作为方法区中类数据的访问入口">类加载器的作用：将class文件字节码内容加载到内存中，并将这些静态数据转换成方法区的运行时数据结构，然后在堆中生成一个代表这个类的Class对象，作为方法区中类数据的访问入口</h5>
<h5 id="类缓存标准的javase类加载器可以按要求查找类但一旦某个类被加载到类加载器中它将维持加载缓存一段时间不过gc可以回收这些class对象">类缓存：标准的JavaSE类加载器可以按要求查找类，但一旦某个类被加载到类加载器中，它将维持加载(缓存)一段时间。不过GC可以回收这些Class对象</h5>
<hr>
<hr>
<h3 id="使用classloader加载配置文件">使用ClassLoader加载配置文件</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test1</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
<span style="color:#75715e">//        写法一
</span><span style="color:#75715e">//        FileInputStream fis = null;
</span><span style="color:#75715e">//        try {
</span><span style="color:#75715e">//            Properties properties = new Properties();
</span><span style="color:#75715e">//            //此时默认位置是在当前module下
</span><span style="color:#75715e">//            fis = new FileInputStream(&#34;jdbc.properties&#34;);
</span><span style="color:#75715e">//            properties.load(fis);
</span><span style="color:#75715e">//
</span><span style="color:#75715e">//            String user = properties.getProperty(&#34;user&#34;);
</span><span style="color:#75715e">//            String pwd = properties.getProperty(&#34;pwd&#34;);
</span><span style="color:#75715e">//            System.out.println(&#34;user =&#34; + user + &#34;, pwd = &#34; + pwd);
</span><span style="color:#75715e">//        } catch (IOException e) {
</span><span style="color:#75715e">//            e.printStackTrace();
</span><span style="color:#75715e">//        } finally {
</span><span style="color:#75715e">//            if (fis != null) {
</span><span style="color:#75715e">//                try {
</span><span style="color:#75715e">//                    fis.close();
</span><span style="color:#75715e">//                } catch (IOException e) {
</span><span style="color:#75715e">//                    e.printStackTrace();
</span><span style="color:#75715e">//                }
</span><span style="color:#75715e">//            }
</span><span style="color:#75715e">//        }
</span><span style="color:#75715e"></span>
        <span style="color:#75715e">//写法二，使用ClassLoader
</span><span style="color:#75715e"></span>        InputStream is <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            ClassLoader classLoader <span style="color:#f92672">=</span> rflTest<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">();</span>
            <span style="color:#75715e">//此时默认位置不在当前module下，而是在当前src下
</span><span style="color:#75715e"></span>            is <span style="color:#f92672">=</span> classLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jdbc.properties&#34;</span><span style="color:#f92672">);</span>
            Properties properties <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Properties<span style="color:#f92672">();</span>
            properties<span style="color:#f92672">.</span><span style="color:#a6e22e">load</span><span style="color:#f92672">(</span>is<span style="color:#f92672">);</span>
            String user <span style="color:#f92672">=</span> properties<span style="color:#f92672">.</span><span style="color:#a6e22e">getProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user&#34;</span><span style="color:#f92672">);</span>
            String pwd <span style="color:#f92672">=</span> properties<span style="color:#f92672">.</span><span style="color:#a6e22e">getProperty</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;pwd&#34;</span><span style="color:#f92672">);</span>

            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;user = &#34;</span> <span style="color:#f92672">+</span> user <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;, pwd = &#34;</span> <span style="color:#f92672">+</span> pwd<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>is <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    is<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div><h4 id="通过反射创建运行时类的对象">通过反射，创建运行时类的对象</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        Class<span style="color:#f92672">&lt;</span>Person<span style="color:#f92672">&gt;</span> personClass <span style="color:#f92672">=</span> Person<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">;</span>
        Person instance <span style="color:#f92672">=</span> personClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredConstructor</span><span style="color:#f92672">().</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">();</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>instance<span style="color:#f92672">);</span>
        <span style="color:#75715e">//Person{name=&#39;null&#39;, age=0, isMale=false, privateMember=&#39;can not access&#39;}
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
</code></pre></div><h4 id="反射的动态性">反射的动态性</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//输入字符串，指明需要的对象的类路径，方法返回对应对象
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Scanner scanner <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Scanner<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">);</span>
        String str <span style="color:#f92672">=</span> scanner<span style="color:#f92672">.</span><span style="color:#a6e22e">nextLine</span><span style="color:#f92672">();</span>
        Object instance <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            instance <span style="color:#f92672">=</span> getInstanceOf<span style="color:#f92672">(</span>str<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>ClassNotFoundException <span style="color:#f92672">|</span> InstantiationException <span style="color:#f92672">|</span> IllegalAccessException <span style="color:#f92672">|</span> NoSuchMethodException <span style="color:#f92672">|</span>
                 InvocationTargetException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>instance<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
	
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Object <span style="color:#a6e22e">getInstanceOf</span><span style="color:#f92672">(</span>String className<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> ClassNotFoundException<span style="color:#f92672">,</span> NoSuchMethodException<span style="color:#f92672">,</span> InvocationTargetException<span style="color:#f92672">,</span> InstantiationException<span style="color:#f92672">,</span> IllegalAccessException <span style="color:#f92672">{</span>
        Class<span style="color:#f92672">&lt;?&gt;</span> forName <span style="color:#f92672">=</span> Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span>className<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> forName<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredConstructor</span><span style="color:#f92672">().</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
</code></pre></div><hr>
<hr>
<h3 id="获取运行时类的完整结构">获取运行时类的完整结构</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">(){</span>
        Class<span style="color:#f92672">&lt;?&gt;</span> creature <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            creature <span style="color:#f92672">=</span> Class<span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Creature&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>ClassNotFoundException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getFields--------------------------&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Field field <span style="color:#f92672">:</span> creature<span style="color:#f92672">.</span><span style="color:#a6e22e">getFields</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
			<span style="color:#75715e">//获取修饰符
</span><span style="color:#75715e"></span>			<span style="color:#75715e">//int modifier = field.getModifiers();
</span><span style="color:#75715e"></span>			<span style="color:#75715e">//Modifier.toString(modifier).sout;
</span><span style="color:#75715e"></span>            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>field<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getDeclaredFields--------------------------&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Field declaredField <span style="color:#f92672">:</span> creature<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredFields</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>declaredField<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getMethods--------------------------&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Method method <span style="color:#f92672">:</span> creature<span style="color:#f92672">.</span><span style="color:#a6e22e">getMethods</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>method<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getDeclaredMethods--------------------------&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Method declaredMethod <span style="color:#f92672">:</span> creature<span style="color:#f92672">.</span><span style="color:#a6e22e">getDeclaredMethods</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>declaredMethod<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>


    <span style="color:#f92672">}</span>
	<span style="color:#75715e">/*Out:
</span><span style="color:#75715e">	getFields--------------------------
</span><span style="color:#75715e">	public int Creature.weight
</span><span style="color:#75715e">	getDeclaredFields--------------------------
</span><span style="color:#75715e">	private char Creature.gender
</span><span style="color:#75715e">	public int Creature.weight
</span><span style="color:#75715e">	getMethods--------------------------
</span><span style="color:#75715e">	public void Creature.breathe()
</span><span style="color:#75715e">	public final native void java.lang.Object.wait(long) throws java.lang.InterruptedException
</span><span style="color:#75715e">	public final void java.lang.Object.wait(long,int) throws java.lang.InterruptedException
</span><span style="color:#75715e">	public final void java.lang.Object.wait() throws java.lang.InterruptedException
</span><span style="color:#75715e">	public boolean java.lang.Object.equals(java.lang.Object)
</span><span style="color:#75715e">	public java.lang.String java.lang.Object.toString()
</span><span style="color:#75715e">	public native int java.lang.Object.hashCode()
</span><span style="color:#75715e">	public final native java.lang.Class java.lang.Object.getClass()
</span><span style="color:#75715e">	public final native void java.lang.Object.notify()
</span><span style="color:#75715e">	public final native void java.lang.Object.notifyAll()
</span><span style="color:#75715e">	getDeclaredMethods--------------------------
</span><span style="color:#75715e">	protected void Creature.sleep()
</span><span style="color:#75715e">	public void Creature.breathe()
</span><span style="color:#75715e">	private void Creature.eat()
</span><span style="color:#75715e">	*/</span>
	
	
	<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Creature</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">char</span> gender<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> weight<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">eat</span><span style="color:#f92672">(){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Creature eat...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">breathe</span><span style="color:#f92672">(){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Creature breathe...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sleep</span><span style="color:#f92672">(){</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Creature sleep...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>


</code></pre></div><ul>
<li>
<p>1.获取成员变量</p>
<p>getFields 获取所有public修饰的变量，包括所有父类中的public变量(下同)</p>
<p>getDeclaredFields 获取指定类中声明的全部成员属性，不包括父类(下同)</p>
<p>getField(String), getDeclaredField(String) 获取指定名字的成员变量，限制同上(下同)</p>
<p>使用set和get方法可以修改成员变量，但是对于private不可修改</p>
<p>可以使用setAccessible(true)来忽略访问权限修饰符的安全检查，暴力反射</p>
</li>
<li>
<p>2.获取构造方法</p>
<p>get&hellip;</p>
<p>getDeclared&hellip;</p>
<p>创建对象 newInstance() 创建对应的对象</p>
</li>
<li>
<p>3.获取成员方法</p>
<p>get&hellip;</p>
<p>getDeclared&hellip;</p>
<p>getMethods() 不止获取你看到的方法，还会获取到Object的一些方法</p>
<p>执行方法 invoke(对象, 参数);</p>
<p>setAccessible()也可以使用</p>
<p>获取方法名称 getName()</p>
<p>使用invoke()方法可以执行方法(当执行的方法为静态方法时，obj参数应赋值null或当前 类.class)</p>
</li>
<li>
<p>4.获取类名等</p>
<p>getName()</p>
</li>
<li>
<p>5.获取注解</p>
<p>getAnnotations()</p>
<p>get&hellip;</p>
</li>
</ul>
<h5 id="总结使用反射可以获取运行时类的方法方法的内部结构构造器父类和父类的泛型接口所在包注解指定的属性指定的方法以及指定的构造器">总结：使用反射可以获取运行时类的：方法、方法的内部结构、构造器、父类和父类的泛型、接口、所在包、注解、指定的属性、指定的方法，以及指定的构造器</h5>
<hr>
<hr>
<h3 id="动态代理">动态代理</h3>
<p>区别于静态代理。静态代理的类和目标对象类都是在编译期确定下来的，不利于程序的扩展。</p>
<ul>
<li>实现动态代理所需要解决的问题：</li>
</ul>
<pre><code>1. 如何根据加载到内存中的被代理类，动态的创建一个代理类及其对象
2. 当通过代理类的对象调用方法时，如何动态地去调用被代理类中的同名方法
</code></pre><h4 id="实现">实现</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProxyTest</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">(){</span>
        <span style="color:#75715e">//通过接口的引用指向实现类的对象
</span><span style="color:#75715e"></span>        Star ZJL <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RealStar<span style="color:#f92672">();</span>
        Star proxyInstance <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>Star<span style="color:#f92672">)</span> ProxyFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getProxyInstance</span><span style="color:#f92672">(</span>ZJL<span style="color:#f92672">);</span>
        
        <span style="color:#75715e">//通过代理类调用方法
</span><span style="color:#75715e"></span>        proxyInstance<span style="color:#f92672">.</span><span style="color:#a6e22e">BookTicket</span><span style="color:#f92672">();</span>
        proxyInstance<span style="color:#f92672">.</span><span style="color:#a6e22e">Confer</span><span style="color:#f92672">();</span>
        proxyInstance<span style="color:#f92672">.</span><span style="color:#a6e22e">Sing</span><span style="color:#f92672">();</span>
        proxyInstance<span style="color:#f92672">.</span><span style="color:#a6e22e">SignContract</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * Proxy processing...
</span><span style="color:#75715e">         * Real Star BookTicket...
</span><span style="color:#75715e">         * Proxy process complete
</span><span style="color:#75715e">         * Proxy processing...
</span><span style="color:#75715e">         * Real Star Confer...
</span><span style="color:#75715e">         * Proxy process complete
</span><span style="color:#75715e">         * Proxy processing...
</span><span style="color:#75715e">         * Real Star Sing...
</span><span style="color:#75715e">         * Proxy process complete
</span><span style="color:#75715e">         * Proxy processing...
</span><span style="color:#75715e">         * Real Star SignContract...
</span><span style="color:#75715e">         * Proxy process complete
</span><span style="color:#75715e">         * 
</span><span style="color:#75715e">         */</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>


<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Star</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Confer</span><span style="color:#f92672">();</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BookTicket</span><span style="color:#f92672">();</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SignContract</span><span style="color:#f92672">();</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Sing</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RealStar</span> <span style="color:#66d9ef">implements</span> Star<span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Confer</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Real Star Confer...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">BookTicket</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Real Star BookTicket...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SignContract</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Real Star SignContract...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Sing</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Real Star Sing...&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProxyFactory</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//调用此方法，返回一个代理类对象，解决问题一
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Object <span style="color:#a6e22e">getProxyInstance</span><span style="color:#f92672">(</span>Object obj<span style="color:#f92672">){</span>
        MyInvocationHandler handler <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MyInvocationHandler<span style="color:#f92672">();</span>
        handler<span style="color:#f92672">.</span><span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span>  Proxy<span style="color:#f92672">.</span><span style="color:#a6e22e">newProxyInstance</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">(),</span> obj<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getInterfaces</span><span style="color:#f92672">(),</span> handler<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyInvocationHandler</span> <span style="color:#66d9ef">implements</span> InvocationHandler<span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> Object obj<span style="color:#f92672">;</span><span style="color:#75715e">//被代理类的对象，其类型不确定，所以定义为Object
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">bind</span><span style="color:#f92672">(</span>Object obj<span style="color:#f92672">){</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> obj<span style="color:#f92672">;</span><span style="color:#75715e">//将被代理类对象与obj绑定
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//当通过代理类对象调用方法method时，会自动调用invoke()方法，解决问题二
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//参数proxy：代理类对象
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//参数method：要执行的方法
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//参数args：参数列表
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>Object proxy<span style="color:#f92672">,</span> Method method<span style="color:#f92672">,</span> Object<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Proxy processing...&#34;</span><span style="color:#f92672">);</span>
        Object res <span style="color:#f92672">=</span> method<span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span>obj<span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Proxy process complete&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> res<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
