<!doctype html>
<html lang="en-us">
  <head>
    <title>SpringMVC // Sp(act)rum</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="冯雪洋" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://shery-long.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SpringMVC"/>
<meta name="twitter:description" content="​	一、SpringMVC特点
​	二、创建SpringMVC工程
​	三、@RequestMapping注解
​	四、SpringMVC获取请求参数
​	五、域对象共享数据
​	六、SpringMVC的视图
​	七、RESTful
​	八、HttpMessageConverter
​	九、文件上传和下载
​	十、拦截器
​	十一、异常处理器
​	十二、注解配置SpringMVC
​	十三、SpringMVC执行流程
SpringMVC是Spring的一个后续产品，是Spring的一个子项目
SpringMVC是Spring为表述层开发提供的一套完备的解决方案。(三层架构分别为表述层(表示层)、业务逻辑层、数据访问层，表述层表示前台页面和后台servlet)
#
一、SpringMVC的特点 1）Spring 家族原生产品，与IoC容器等基础设施无缝对接 2）基于原生的Servlet，通过功能强大的前端控制器DispatcherServlet，对请求和响应进行统一处理 3）表述层各细分领域需要解决的问题全方位覆盖，提供全面解决方案 4）代码清新简洁，大幅度提升开发效率 5）内部组件化程度高，可插拔式组件即插即用，想要什么功能配置相应组件即可 6）性能卓著，尤其适合现代大型、超大型互联网项目要求   #
二、创建SpringMVC工程 创建maven工程 1.pom.xml中引入依赖，打包方式：war &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;org.sherry&lt;/groupId&gt; &lt;artifactId&gt;demo1&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- SpringMVC --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;5.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;!"/>

    <meta property="og:title" content="SpringMVC" />
<meta property="og:description" content="​	一、SpringMVC特点
​	二、创建SpringMVC工程
​	三、@RequestMapping注解
​	四、SpringMVC获取请求参数
​	五、域对象共享数据
​	六、SpringMVC的视图
​	七、RESTful
​	八、HttpMessageConverter
​	九、文件上传和下载
​	十、拦截器
​	十一、异常处理器
​	十二、注解配置SpringMVC
​	十三、SpringMVC执行流程
SpringMVC是Spring的一个后续产品，是Spring的一个子项目
SpringMVC是Spring为表述层开发提供的一套完备的解决方案。(三层架构分别为表述层(表示层)、业务逻辑层、数据访问层，表述层表示前台页面和后台servlet)
#
一、SpringMVC的特点 1）Spring 家族原生产品，与IoC容器等基础设施无缝对接 2）基于原生的Servlet，通过功能强大的前端控制器DispatcherServlet，对请求和响应进行统一处理 3）表述层各细分领域需要解决的问题全方位覆盖，提供全面解决方案 4）代码清新简洁，大幅度提升开发效率 5）内部组件化程度高，可插拔式组件即插即用，想要什么功能配置相应组件即可 6）性能卓著，尤其适合现代大型、超大型互联网项目要求   #
二、创建SpringMVC工程 创建maven工程 1.pom.xml中引入依赖，打包方式：war &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;org.sherry&lt;/groupId&gt; &lt;artifactId&gt;demo1&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;properties&gt; &lt;maven.compiler.source&gt;11&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;11&lt;/maven.compiler.target&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- SpringMVC --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;5.3.1&lt;/version&gt; &lt;/dependency&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shery-long.github.io/post/springmvc/" />
<meta property="article:published_time" content="2022-10-11T11:02:42+08:00" />
<meta property="article:modified_time" content="2022-10-11T11:02:42+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://shery-long.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="冯雪洋" /></a>
      <h1>Sp(act)rum</h1>
      <p>这个人很懒，什么介绍都没留下</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/Sherry-long" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://space.bilibili.com/13547597" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link">
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">SpringMVC</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Oct 11, 2022
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          14 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>​	<a href="#feature">一、SpringMVC特点</a></p>
<p>​	<a href="#CreateProject">二、创建SpringMVC工程</a></p>
<p>​	<a href="#RequestMapping">三、@RequestMapping注解</a></p>
<p>​	<a href="#GetParam">四、SpringMVC获取请求参数</a></p>
<p>​	<a href="#FieldObj">五、域对象共享数据</a></p>
<p>​	<a href="#MVC-View">六、SpringMVC的视图</a></p>
<p>​	<a href="#RESTful">七、RESTful</a></p>
<p>​	<a href="#HttpMessageConverter">八、HttpMessageConverter</a></p>
<p>​	<a href="#Files">九、文件上传和下载</a></p>
<p>​	<a href="#Interceptor">十、拦截器</a></p>
<p>​	<a href="#ExceptionXeqtr">十一、异常处理器</a></p>
<p>​	<a href="#mvcAnno">十二、注解配置SpringMVC</a></p>
<p>​	<a href="#mvcSource">十三、SpringMVC执行流程</a></p>
<p>SpringMVC是Spring的一个后续产品，是Spring的一个子项目</p>
<p>SpringMVC是Spring为表述层开发提供的一套完备的解决方案。(三层架构分别为表述层(表示层)、业务逻辑层、数据访问层，表述层表示前台页面和后台servlet)</p>
<p><a id="feature">#</a></p>
<h3 id="一springmvc的特点">一、SpringMVC的特点</h3>
<pre><code>1）Spring 家族原生产品，与IoC容器等基础设施无缝对接

2）基于原生的Servlet，通过功能强大的前端控制器DispatcherServlet，对请求和响应进行统一处理

3）表述层各细分领域需要解决的问题全方位覆盖，提供全面解决方案

4）代码清新简洁，大幅度提升开发效率

5）内部组件化程度高，可插拔式组件即插即用，想要什么功能配置相应组件即可

6）性能卓著，尤其适合现代大型、超大型互联网项目要求
</code></pre><hr>
<hr>
<p><a id="CreateProject">#</a></p>
<h3 id="二创建springmvc工程">二、创建SpringMVC工程</h3>
<h4 id="创建maven工程">创建maven工程</h4>
<h5 id="1pomxml中引入依赖打包方式war">1.pom.xml中引入依赖，打包方式：war</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
&lt;<span style="color:#f92672">project</span> <span style="color:#a6e22e">xmlns</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
         <span style="color:#a6e22e">xmlns:xsi</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
         <span style="color:#a6e22e">xsi:schemaLocation</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span>&gt;
    &lt;<span style="color:#f92672">modelVersion</span>&gt;4.0.0&lt;/<span style="color:#f92672">modelVersion</span>&gt;

    &lt;<span style="color:#f92672">groupId</span>&gt;org.sherry&lt;/<span style="color:#f92672">groupId</span>&gt;
    &lt;<span style="color:#f92672">artifactId</span>&gt;demo1&lt;/<span style="color:#f92672">artifactId</span>&gt;
    &lt;<span style="color:#f92672">version</span>&gt;1.0-SNAPSHOT&lt;/<span style="color:#f92672">version</span>&gt;
    &lt;<span style="color:#f92672">packaging</span>&gt;war&lt;/<span style="color:#f92672">packaging</span>&gt;

    &lt;<span style="color:#f92672">properties</span>&gt;
        &lt;<span style="color:#f92672">maven.compiler.source</span>&gt;11&lt;/<span style="color:#f92672">maven.compiler.source</span>&gt;
        &lt;<span style="color:#f92672">maven.compiler.target</span>&gt;11&lt;/<span style="color:#f92672">maven.compiler.target</span>&gt;
        &lt;<span style="color:#f92672">project.build.sourceEncoding</span>&gt;UTF-8&lt;/<span style="color:#f92672">project.build.sourceEncoding</span>&gt;
    &lt;/<span style="color:#f92672">properties</span>&gt;
    &lt;<span style="color:#f92672">dependencies</span>&gt;
        <span style="color:#75715e">&lt;!-- SpringMVC --&gt;</span>
        &lt;<span style="color:#f92672">dependency</span>&gt;
            &lt;<span style="color:#f92672">groupId</span>&gt;org.springframework&lt;/<span style="color:#f92672">groupId</span>&gt;
            &lt;<span style="color:#f92672">artifactId</span>&gt;spring-webmvc&lt;/<span style="color:#f92672">artifactId</span>&gt;
            &lt;<span style="color:#f92672">version</span>&gt;5.3.1&lt;/<span style="color:#f92672">version</span>&gt;
        &lt;/<span style="color:#f92672">dependency</span>&gt;

        <span style="color:#75715e">&lt;!-- 日志 --&gt;</span>
        &lt;<span style="color:#f92672">dependency</span>&gt;
            &lt;<span style="color:#f92672">groupId</span>&gt;ch.qos.logback&lt;/<span style="color:#f92672">groupId</span>&gt;
            &lt;<span style="color:#f92672">artifactId</span>&gt;logback-classic&lt;/<span style="color:#f92672">artifactId</span>&gt;
            &lt;<span style="color:#f92672">version</span>&gt;1.2.9&lt;/<span style="color:#f92672">version</span>&gt;
        &lt;/<span style="color:#f92672">dependency</span>&gt;

        <span style="color:#75715e">&lt;!-- ServletAPI --&gt;</span>
        &lt;<span style="color:#f92672">dependency</span>&gt;
            &lt;<span style="color:#f92672">groupId</span>&gt;javax.servlet&lt;/<span style="color:#f92672">groupId</span>&gt;
            &lt;<span style="color:#f92672">artifactId</span>&gt;javax.servlet-api&lt;/<span style="color:#f92672">artifactId</span>&gt;
            &lt;<span style="color:#f92672">version</span>&gt;3.1.0&lt;/<span style="color:#f92672">version</span>&gt;
            &lt;<span style="color:#f92672">scope</span>&gt;provided&lt;/<span style="color:#f92672">scope</span>&gt;
        &lt;/<span style="color:#f92672">dependency</span>&gt;

        <span style="color:#75715e">&lt;!-- Spring5和Thymeleaf整合包 --&gt;</span>
        &lt;<span style="color:#f92672">dependency</span>&gt;
            &lt;<span style="color:#f92672">groupId</span>&gt;org.thymeleaf&lt;/<span style="color:#f92672">groupId</span>&gt;
            &lt;<span style="color:#f92672">artifactId</span>&gt;thymeleaf-spring5&lt;/<span style="color:#f92672">artifactId</span>&gt;
            &lt;<span style="color:#f92672">version</span>&gt;3.0.13.RELEASE&lt;/<span style="color:#f92672">version</span>&gt;
        &lt;/<span style="color:#f92672">dependency</span>&gt;
    &lt;/<span style="color:#f92672">dependencies</span>&gt;

&lt;/<span style="color:#f92672">project</span>&gt;
</code></pre></div><h5 id="2添加web模块project-structure-modules-current-module-web-在srcmainwebappweb-inf中创建webxml">2.添加web模块：Project Structure-&gt;modules-&gt;current module-&gt;Web-&gt;在src\main\webapp\WEB-INF中创建web.xml</h5>
<h5 id="3配置webxml">3.配置web.xml</h5>
<p>注册SpringMVC的前端控制器DispatcherServlet</p>
<p>默认配置方式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">此配置作用下，SpringMVC的配置文件默认位于WEB-INF下，默认名称为-servlet.xml，
例如，以下配置所对应SpringMVC的配置文件位于WEB-INF下，文件名为springMVC-servlet.xml


<span style="color:#75715e">&lt;!-- 配置SpringMVC的前端控制器，对浏览器发送的请求统一进行处理 --&gt;</span>
	&lt;<span style="color:#f92672">servlet</span>&gt;
		&lt;<span style="color:#f92672">servlet-name</span>&gt;springMVC&lt;/<span style="color:#f92672">servlet-name</span>&gt;
		&lt;<span style="color:#f92672">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;/<span style="color:#f92672">servlet-class</span>&gt;
	&lt;/<span style="color:#f92672">servlet</span>&gt;
	&lt;<span style="color:#f92672">servlet-mapping</span>&gt;
		&lt;<span style="color:#f92672">servlet-name</span>&gt;springMVC&lt;/<span style="color:#f92672">servlet-name</span>&gt;
<span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">	设置springMVC的核心控制器所能处理的请求的请求路径
</span><span style="color:#75715e">	/所匹配的请求可以是/login或.html或.js或.css方式的请求路径
</span><span style="color:#75715e">	但是/不能匹配.jsp请求路径的请求
</span><span style="color:#75715e">	因为jsp本质上是servlet，需要被对应的servlet处理，不能被dispatcherservlet捕获
</span><span style="color:#75715e">--&gt;</span>
		&lt;<span style="color:#f92672">url-pattern</span>&gt;/&lt;/<span style="color:#f92672">url-pattern</span>&gt;
	&lt;/<span style="color:#f92672">servlet-mapping</span>&gt;


</code></pre></div><p>扩展配置方式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">可通过init-param标签设置SpringMVC配置文件的位置和名称，通过load-on-startup标签
设置SpringMVC前端控制器DispatcherServlet的初始化时间


可通过init-param标签设置SpringMVC配置文件的位置和名称，通过load-on-startup标签设置SpringMVC前端控制器DispatcherServlet的初始化时间

<span style="color:#75715e">&lt;!-- 配置SpringMVC的前端控制器，对浏览器发送的请求统一进行处理 --&gt;</span>
	&lt;<span style="color:#f92672">servlet</span>&gt;
		&lt;<span style="color:#f92672">servlet-name</span>&gt;springMVC&lt;/<span style="color:#f92672">servlet-name</span>&gt;
		&lt;<span style="color:#f92672">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;/<span style="color:#f92672">servlet-class</span>&gt;
<span style="color:#75715e">&lt;!-- 通过初始化参数指定SpringMVC配置文件的位置和名称 --&gt;</span>
		&lt;<span style="color:#f92672">init-param</span>&gt;
<span style="color:#75715e">&lt;!-- contextConfigLocation为固定值 --&gt;</span>
			&lt;<span style="color:#f92672">param-name</span>&gt;contextConfigLocation&lt;/<span style="color:#f92672">param-name</span>&gt;
<span style="color:#75715e">&lt;!-- 使用classpath:表示从类路径查找配置文件，例如maven工程中的src/main/resources --&gt;</span>
			&lt;<span style="color:#f92672">param-value</span>&gt;classpath:springMVC.xml&lt;/<span style="color:#f92672">param-value</span>&gt;
		&lt;/<span style="color:#f92672">init-param</span>&gt;
<span style="color:#75715e">&lt;!-- 
</span><span style="color:#75715e">	 作为框架的核心组件，在启动过程中有大量的初始化操作要做
</span><span style="color:#75715e">	而这些操作放在第一次请求时才执行会严重影响访问速度
</span><span style="color:#75715e">	因此需要通过此标签将启动控制DispatcherServlet的初始化时间提前到服务器启动时
</span><span style="color:#75715e">--&gt;</span>
		&lt;<span style="color:#f92672">load-on-startup</span>&gt;1&lt;/<span style="color:#f92672">load-on-startup</span>&gt;
	&lt;/<span style="color:#f92672">servlet</span>&gt;
	&lt;<span style="color:#f92672">servlet-mapping</span>&gt;
		&lt;<span style="color:#f92672">servlet-name</span>&gt;springMVC&lt;/<span style="color:#f92672">servlet-name</span>&gt;
<span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">	设置springMVC的核心控制器所能处理的请求的请求路径
</span><span style="color:#75715e">	/所匹配的请求可以是/login或.html或.js或.css方式的请求路径
</span><span style="color:#75715e">	但是/不能匹配.jsp请求路径的请求
</span><span style="color:#75715e">--&gt;</span>
		&lt;<span style="color:#f92672">url-pattern</span>&gt;/&lt;/<span style="color:#f92672">url-pattern</span>&gt;
	&lt;/<span style="color:#f92672">servlet-mapping</span>&gt;


</code></pre></div><h5 id="4创建请求控制器">4.创建请求控制器</h5>
<p>由于前端控制器对浏览器发送的请求进行了统一的处理，但是具体的请求有不同的处理过程，因此需要创建处理具体请求的类，即请求控制器</p>
<p>请求控制器中每一个处理请求的方法称为控制器方法</p>
<p>因为SpringMVC的控制器由一个POJO（普通的Java类）担任，因此需要通过@Controller注解将其标识为一个控制层组件，交给Spring的IoC容器管理，此时SpringMVC才能够识别控制器的存在</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Controller</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HelloController</span> <span style="color:#f92672">{</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="5创建springmvc的配置文件">5.创建springMVC的配置文件</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!-- 自动扫描包 --&gt;</span>
&lt;<span style="color:#f92672">context:component-scan</span> <span style="color:#a6e22e">base-package</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;com.atguigu.mvc.controller&#34;</span>/&gt;

<span style="color:#75715e">&lt;!-- 配置Thymeleaf视图解析器 --&gt;</span>
&lt;<span style="color:#f92672">bean</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewResolver&#34;</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;org.thymeleaf.spring5.view.ThymeleafViewResolver&#34;</span>&gt;
    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;order&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;1&#34;</span>/&gt;
    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;characterEncoding&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>/&gt;
    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;templateEngine&#34;</span>&gt;
        &lt;<span style="color:#f92672">bean</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;org.thymeleaf.spring5.SpringTemplateEngine&#34;</span>&gt;
            &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;templateResolver&#34;</span>&gt;
                &lt;<span style="color:#f92672">bean</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver&#34;</span>&gt;
    
                    <span style="color:#75715e">&lt;!-- 视图前缀 --&gt;</span>
                    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;prefix&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/WEB-INF/templates/&#34;</span>/&gt;
    
                    <span style="color:#75715e">&lt;!-- 视图后缀 --&gt;</span>
                    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;suffix&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.html&#34;</span>/&gt;
                    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;templateMode&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;HTML5&#34;</span>/&gt;
                    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;characterEncoding&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
                &lt;/<span style="color:#f92672">bean</span>&gt;
            &lt;/<span style="color:#f92672">property</span>&gt;
        &lt;/<span style="color:#f92672">bean</span>&gt;
    &lt;/<span style="color:#f92672">property</span>&gt;
&lt;/<span style="color:#f92672">bean</span>&gt;

<span style="color:#75715e">&lt;!-- 
</span><span style="color:#75715e">   处理静态资源，例如html、js、css、jpg
</span><span style="color:#75715e">  若只设置该标签，则只能访问静态资源，其他请求则无法访问
</span><span style="color:#75715e">  此时必须设置&lt;mvc:annotation-driven/&gt;解决问题
</span><span style="color:#75715e"> --&gt;</span>
&lt;<span style="color:#f92672">mvc:default-servlet-handler</span>/&gt;

<span style="color:#75715e">&lt;!-- 开启mvc注解驱动 --&gt;</span>
&lt;<span style="color:#f92672">mvc:annotation-driven</span>&gt;
    &lt;<span style="color:#f92672">mvc:message-converters</span>&gt;
        <span style="color:#75715e">&lt;!-- 处理响应中文内容乱码 --&gt;</span>
        &lt;<span style="color:#f92672">bean</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;org.springframework.http.converter.StringHttpMessageConverter&#34;</span>&gt;
            &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;defaultCharset&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
            &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;supportedMediaTypes&#34;</span>&gt;
                &lt;<span style="color:#f92672">list</span>&gt;
                    &lt;<span style="color:#f92672">value</span>&gt;text/html&lt;/<span style="color:#f92672">value</span>&gt;
                    &lt;<span style="color:#f92672">value</span>&gt;application/json&lt;/<span style="color:#f92672">value</span>&gt;
                &lt;/<span style="color:#f92672">list</span>&gt;
            &lt;/<span style="color:#f92672">property</span>&gt;
        &lt;/<span style="color:#f92672">bean</span>&gt;
    &lt;/<span style="color:#f92672">mvc:message-converters</span>&gt;
&lt;/<span style="color:#f92672">mvc:annotation-driven</span>&gt;
</code></pre></div><h5 id="6测试">6.测试</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">在请求控制器中创建处理请求的方法

<span style="color:#75715e">// @RequestMapping注解：处理请求和控制器方法之间的映射关系
</span><span style="color:#75715e">// @RequestMapping注解的value属性可以通过请求地址匹配请求，/表示的当前工程的上下文路径
</span><span style="color:#75715e">// localhost:8080/springMVC/
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">index</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//设置视图名称
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;index&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">在主页index.html中设置超链接

<span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span> <span style="color:#a6e22e">xmlns:th</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://www.thymeleaf.org&#34;</span>&gt;
&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
    &lt;<span style="color:#f92672">title</span>&gt;首页&lt;/<span style="color:#f92672">title</span>&gt;
&lt;/<span style="color:#f92672">head</span>&gt;
&lt;<span style="color:#f92672">body</span>&gt;
    &lt;<span style="color:#f92672">h1</span>&gt;首页&lt;/<span style="color:#f92672">h1</span>&gt;
    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/target}&#34;</span>&gt;跳转到target页面&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>/&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">在请求控制器中创建处理请求的方法

<span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/target&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">Target</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;target&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><pre><code>将项目部署到本地tomcat服务器上
Tomcat -&gt; Edit Configuration -&gt; Deployment -&gt; + -&gt; Artifact -&gt; ProjectName:war exploded -&gt; 修改Application context(可不修改) -&gt; 修改server设置 -&gt; apply
</code></pre><h5 id="总结">总结</h5>
<p>浏览器发送请求，若请求地址符合前端控制器的url-pattern，该请求就会被前端控制器DispatcherServlet处理。
前端控制器会读取SpringMVC的核心配置文件，通过扫描组件找到控制器，将请求地址和控制器中@RequestMapping注解的value属性值进行匹配，
若匹配成功，该注解所标识的控制器方法就是处理请求的方法。处理请求的方法需要返回一个字符串类型的视图名称，
该视图名称会被视图解析器解析，加上前缀和后缀组成视图的路径，通过Thymeleaf对视图进行渲染，最终转发到视图所对应页面</p>
<hr>
<hr>
<p><a id="RequestMapping">#</a></p>
<h3 id="三requestmapping注解">三、@RequestMapping注解</h3>
<h4 id="requestmapping注解的功能">@RequestMapping注解的功能</h4>
<p>从注解名称上我们可以看到，@RequestMapping注解的作用就是将请求和处理请求的控制器方法关联起来，建立映射关系。</p>
<p>SpringMVC 接收到指定的请求，就会来找到在映射关系中对应的控制器方法来处理这个请求</p>
<h4 id="requestmapping注解的位置">@RequestMapping注解的位置</h4>
<p>@RequestMapping标识一个类：设置映射请求的请求路径的初始信息</p>
<p>@RequestMapping标识一个方法：设置映射请求请求路径的具体信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Controller</span>
<span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/test&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RequestMappingController</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">//此时请求映射所映射的请求的请求路径为：/test/testRequestMapping
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testRequestMapping&#34;</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testRequestMapping</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><h4 id="requestmapping注解的value属性">@RequestMapping注解的value属性</h4>
<p>@RequestMapping注解的value属性通过请求的请求地址匹配请求映射</p>
<p>@RequestMapping注解的value属性是一个字符串类型的数组，表示该请求映射能够匹配多个请求地址所对应的请求</p>
<p>@RequestMapping注解的value属性必须设置，至少通过请求地址匹配请求映射</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/testRequestMapping}&#34;</span>&gt;测试@RequestMapping的value属性--&gt;/testRequestMapping&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/test}&#34;</span>&gt;测试@RequestMapping的value属性--&gt;/test&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
12
@RequestMapping(
        value = {&#34;/testRequestMapping&#34;, &#34;/test&#34;}
)
public String testRequestMapping(){
    return &#34;success&#34;;
}
</code></pre></div><h4 id="requestmapping注解的method属性">@RequestMapping注解的method属性</h4>
<p>@RequestMapping注解的method属性通过请求的请求方式（get或post）匹配请求映射</p>
<p>@RequestMapping注解的method属性是一个RequestMethod类型的数组，表示该请求映射能够匹配多种请求方式的请求</p>
<p>若当前请求的请求地址满足请求映射的value属性，但是请求方式不满足method属性，则浏览器报错405：Request method ‘POST’ not supported</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/test}&#34;</span>&gt;测试@RequestMapping的value属性--&gt;/test&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">th:action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/test}&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span>
        value <span style="color:#f92672">=</span> <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;/testRequestMapping&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;/test&#34;</span><span style="color:#f92672">},</span>
        method <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>RequestMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">GET</span><span style="color:#f92672">,</span> RequestMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">POST</span><span style="color:#f92672">}</span>
<span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testRequestMapping</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><pre><code>注：

1、对于处理指定请求方式的控制器方法，SpringMVC中提供了@RequestMapping的派生注解

处理get请求的映射–&gt;@GetMapping

处理post请求的映射–&gt;@PostMapping

处理put请求的映射–&gt;@PutMapping

处理delete请求的映射–&gt;@DeleteMapping

2、常用的请求方式有get，post，put，delete

但是目前浏览器只支持get和post，若在form表单提交时，为method设置了其他请求方式的字符串（put或delete），则按照默认的请求方式get处理

若要发送put和delete请求，则需要通过spring提供的过滤器HiddenHttpMethodFilter，在RESTful部分会讲到
</code></pre><h4 id="requestmapping注解的params属性">@RequestMapping注解的params属性</h4>
<p>@RequestMapping注解的params属性通过请求的请求参数匹配请求映射</p>
<p>@RequestMapping注解的params属性是一个字符串类型的数组，可以通过四种表达式设置请求参数和请求映射的匹配关系</p>
<p>“param”：要求请求映射所匹配的请求必须携带param请求参数</p>
<p>“!param”：要求请求映射所匹配的请求必须不能携带param请求参数</p>
<p>“param=value”：要求请求映射所匹配的请求必须携带param请求参数且param=value</p>
<p>“param!=value”：要求请求映射所匹配的请求必须携带param请求参数但是param!=value</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/test(username=&#39;admin&#39;,password=123456)&#34;</span>&gt;测试@RequestMapping的params属性--&gt;/test&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
1
@RequestMapping(
        value = {&#34;/testRequestMapping&#34;, &#34;/test&#34;}
        ,method = {RequestMethod.GET, RequestMethod.POST}
        ,params = {&#34;username&#34;,&#34;password!=123456&#34;}
)
public String testRequestMapping(){
    return &#34;success&#34;;
}
</code></pre></div><pre><code>注：

若当前请求满足@RequestMapping注解的value和method属性，但是不满足params属性，
此时页面回报错400：Parameter conditions “username, password!=123456” 
not met for actual request parameters: username={admin}, password={123456}
</code></pre><h4 id="requestmapping注解的headers属性">@RequestMapping注解的headers属性</h4>
<p>@RequestMapping注解的headers属性通过请求的请求头信息匹配请求映射</p>
<p>@RequestMapping注解的headers属性是一个字符串类型的数组，可以通过四种表达式设置请求头信息和请求映射的匹配关系</p>
<p>“header”：要求请求映射所匹配的请求必须携带header请求头信息</p>
<p>“!header”：要求请求映射所匹配的请求必须不能携带header请求头信息</p>
<p>“header=value”：要求请求映射所匹配的请求必须携带header请求头信息且header=value</p>
<p>“header!=value”：要求请求映射所匹配的请求必须携带header请求头信息且header!=value</p>
<p>若当前请求满足@RequestMapping注解的value和method属性，但是不满足headers属性，此时页面显示404错误，即资源未找到</p>
<h4 id="springmvc支持ant风格的路径">SpringMVC支持ant风格的路径</h4>
<pre><code>？：表示任意的单个字符

*：表示任意的0个或多个字符

**：表示任意的一层或多层目录

注意：在使用时，只能使用//xxx的方式
</code></pre><h4 id="springmvc支持路径中的占位符">SpringMVC支持路径中的占位符</h4>
<p>原始方式：/deleteUser?id=1</p>
<p>rest方式：/deleteUser/1</p>
<p>SpringMVC路径中的占位符常用于RESTful风格中，当请求路径中将某些数据通过路径的方式传输到服务器中，
就可以在相应的@RequestMapping注解的value属性中通过占位符{xxx}表示传输的数据，在通过@PathVariable注解，
将占位符所表示的数据赋值给控制器方法的形参</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/testRest/1/admin}&#34;</span>&gt;测试路径中的占位符--&gt;/testRest&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testRest/{id}/{username}&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testRest</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> String id<span style="color:#f92672">,</span> <span style="color:#a6e22e">@PathVariable</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">)</span> String username<span style="color:#f92672">){</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id:&#34;</span><span style="color:#f92672">+</span>id<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;,username:&#34;</span><span style="color:#f92672">+</span>username<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">//最终输出的内容为--&gt;id:1,username:admin
</span></code></pre></div><hr>
<hr>
<p><a id="GetParam">#</a></p>
<h3 id="四springmvc获取请求参数">四、SpringMVC获取请求参数</h3>
<h4 id="通过servletapi获取">通过ServletAPI获取</h4>
<p>将HttpServletRequest作为控制器方法的形参，此时HttpServletRequest类型的参数表示封装了当前请求的请求报文的对象</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testParam&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testParam</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">){</span>
    String username <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username&#34;</span><span style="color:#f92672">);</span>
    String password <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getParameter</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username:&#34;</span><span style="color:#f92672">+</span>username<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;,password:&#34;</span><span style="color:#f92672">+</span>password<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="通过控制器方法的形参获取请求参数">通过控制器方法的形参获取请求参数</h4>
<p>在控制器方法的形参位置，设置和请求参数同名的形参，当浏览器发送请求，匹配到请求映射时，在DispatcherServlet中就会将请求参数赋值给相应的形参</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/testParam(username=&#39;admin&#39;,password=123456)}&#34;</span>&gt;测试获取请求参数--&gt;/testParam&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testParam&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testParam</span><span style="color:#f92672">(</span>String username<span style="color:#f92672">,</span> String password<span style="color:#f92672">){</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username:&#34;</span><span style="color:#f92672">+</span>username<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;,password:&#34;</span><span style="color:#f92672">+</span>password<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><pre><code>注：

若请求所传输的请求参数中有多个同名的请求参数，此时可以在控制器方法的形参中设置字符串数组或者字符串类型的形参接收此请求参数

若使用字符串数组类型的形参，此参数的数组中包含了每一个数据

若使用字符串类型的形参，此参数的值为每个数据中间使用逗号拼接的结果
</code></pre><h4 id="requestparam">@RequestParam</h4>
<p>@RequestParam是将请求参数和控制器方法的形参创建映射关系</p>
<p>@RequestParam注解一共有三个属性：</p>
<p>value：指定为形参赋值的请求参数的参数名</p>
<p>required：设置是否必须传输此请求参数，默认值为true</p>
<p>若设置为true时，则当前请求必须传输value所指定的请求参数，若没有传输该请求参数，且没有设置defaultValue属性，则页面报错400：Required String parameter ‘xxx’ is not present；若设置为false，则当前请求不是必须传输value所指定的请求参数，若没有传输，则注解所标识的形参的值为null</p>
<p>defaultValue：不管required属性值为true或false，当value所指定的请求参数没有传输或传输的值为&quot;&ldquo;时，则使用默认值为形参赋值</p>
<h4 id="requestheader">@RequestHeader</h4>
<p>@RequestHeader是将请求头信息和控制器方法的形参创建映射关系</p>
<p>@RequestHeader注解一共有三个属性：value、required、defaultValue，用法同@RequestParam</p>
<h4 id="cookievalue">@CookieValue</h4>
<p>@CookieValue是将cookie数据和控制器方法的形参创建映射关系</p>
<p>@CookieValue注解一共有三个属性：value、required、defaultValue，用法同@RequestParam</p>
<pre><code>当浏览器第一次向服务器发送请求时，服务器会生成一个Cookie存储到本地的Map中，并通过响应报文回复给浏览器，之后浏览器与服务器进行会话时，Cookie将存在于请求报文中
</code></pre><h4 id="通过pojo获取请求参数">通过POJO获取请求参数</h4>
<p>可以在控制器方法的形参位置设置一个实体类类型的形参，此时若浏览器传输的请求参数的参数名和实体类中的属性名一致，那么请求参数就会为此属性赋值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">th:action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/testpojo}&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    用户名：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;username&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
    密码：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
    性别：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;radio&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sex&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;男&#34;</span>&gt;男&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;radio&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sex&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;女&#34;</span>&gt;女&lt;<span style="color:#f92672">br</span>&gt;
    年龄：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;age&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
    邮箱：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;email&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testpojo&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testPOJO</span><span style="color:#f92672">(</span>User user<span style="color:#f92672">){</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">//最终结果--&gt;User{id=null, username=&#39;张三&#39;, password=&#39;123&#39;, age=23, sex=&#39;男&#39;, email=&#39;123@qq.com&#39;}
</span></code></pre></div><h4 id="解决获取请求参数的乱码问题">解决获取请求参数的乱码问题</h4>
<p>如果在使用get请求时遇到乱码情况，是tomcat服务器的问题，在其conf\server.xml中修改编码方式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;Connector</span> <span style="color:#a6e22e">port=</span><span style="color:#e6db74">&#34;8080&#34;</span> <span style="color:#a6e22e">URIEncoding=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> <span style="color:#a6e22e">protocol=</span><span style="color:#e6db74">&#34;HTTP/1.1&#34;</span>
           <span style="color:#a6e22e">connectionTimeout=</span><span style="color:#e6db74">&#34;20000&#34;</span>
           <span style="color:#a6e22e">redirectPort=</span><span style="color:#e6db74">&#34;8443&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p><strong>注：Tomcat8以后的版本默认的请求编码方式为UTF-8，不再需要进行此配置</strong></p>
<p>解决获取请求参数的乱码问题，可以使用SpringMVC提供的编码过滤器CharacterEncodingFilter，但是必须在web.xml中进行注册</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--配置springMVC的编码过滤器--&gt;</span>

<span style="color:#f92672">&lt;filter&gt;</span>
    <span style="color:#f92672">&lt;filter-name&gt;</span>CharacterEncodingFilter<span style="color:#f92672">&lt;/filter-name&gt;</span>
    <span style="color:#f92672">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span style="color:#f92672">&lt;/filter-class&gt;</span>
    <span style="color:#f92672">&lt;init-param&gt;</span>
        <span style="color:#f92672">&lt;param-name&gt;</span>encoding<span style="color:#f92672">&lt;/param-name&gt;</span>
        <span style="color:#f92672">&lt;param-value&gt;</span>UTF-8<span style="color:#f92672">&lt;/param-value&gt;</span>
    <span style="color:#f92672">&lt;/init-param&gt;</span>
    <span style="color:#f92672">&lt;init-param&gt;</span>
        <span style="color:#f92672">&lt;param-name&gt;</span>forceResponseEncoding<span style="color:#f92672">&lt;/param-name&gt;</span>
        <span style="color:#f92672">&lt;param-value&gt;</span>true<span style="color:#f92672">&lt;/param-value&gt;</span>
    <span style="color:#f92672">&lt;/init-param&gt;</span>
<span style="color:#f92672">&lt;/filter&gt;</span>
<span style="color:#f92672">&lt;filter-mapping&gt;</span>
    <span style="color:#f92672">&lt;filter-name&gt;</span>CharacterEncodingFilter<span style="color:#f92672">&lt;/filter-name&gt;</span>
    <span style="color:#f92672">&lt;url-pattern&gt;</span>/*<span style="color:#f92672">&lt;/url-pattern&gt;</span>
<span style="color:#f92672">&lt;/filter-mapping&gt;</span>
</code></pre></div><p><strong>SpringMVC中处理编码的过滤器一定要配置到其他过滤器之前，否则无效</strong></p>
<hr>
<hr>
<p><a id="FieldObj">#</a></p>
<h3 id="五域对象共享数据">五、域对象共享数据</h3>
<h4 id="1使用servletapi向request域对象共享数据">1.使用ServletAPI向request域对象共享数据</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testServletAPI&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testServletAPI</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">){</span>
    request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testScope&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello,servletAPI&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="2使用modelandview向request域对象共享数据">2.使用ModelAndView向request域对象共享数据</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testModelAndView&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> ModelAndView <span style="color:#a6e22e">testModelAndView</span><span style="color:#f92672">(){</span>
    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * ModelAndView有Model和View的功能
</span><span style="color:#75715e">     * Model主要用于向请求域共享数据
</span><span style="color:#75715e">     * View主要用于设置视图，实现页面跳转
</span><span style="color:#75715e">     */</span>
    ModelAndView mav <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ModelAndView<span style="color:#f92672">();</span>
    <span style="color:#75715e">//向请求域共享数据
</span><span style="color:#75715e"></span>    mav<span style="color:#f92672">.</span><span style="color:#a6e22e">addObject</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testScope&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello,ModelAndView&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//设置视图，实现页面跳转
</span><span style="color:#75715e"></span>    mav<span style="color:#f92672">.</span><span style="color:#a6e22e">setViewName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> mav<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="3使用model向request域对象共享数据">3.使用Model向request域对象共享数据</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testModel&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testModel</span><span style="color:#f92672">(</span>Model model<span style="color:#f92672">){</span>
    model<span style="color:#f92672">.</span><span style="color:#a6e22e">addAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testScope&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello,Model&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="4使用map向request域对象共享数据">4.使用map向request域对象共享数据</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testMap&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testMap</span><span style="color:#f92672">(</span>Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> map<span style="color:#f92672">){</span>
    map<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testScope&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello,Map&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="5使用modelmap向request域对象共享数据">5.使用ModelMap向request域对象共享数据</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testModelMap&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testModelMap</span><span style="color:#f92672">(</span>ModelMap modelMap<span style="color:#f92672">){</span>
    modelMap<span style="color:#f92672">.</span><span style="color:#a6e22e">addAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testScope&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello,ModelMap&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="6modelmodelmapmap的关系">6.Model、ModelMap、Map的关系</h4>
<p>Model、ModelMap、Map类型的参数其实本质上都是 BindingAwareModelMap 类型的</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">Model</span><span style="color:#f92672">{}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ModelMap</span> <span style="color:#66d9ef">extends</span> LinkedHashMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExtendedModelMap</span> <span style="color:#66d9ef">extends</span> ModelMap <span style="color:#66d9ef">implements</span> Model <span style="color:#f92672">{}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BindingAwareModelMap</span> <span style="color:#66d9ef">extends</span> ExtendedModelMap <span style="color:#f92672">{}</span>
</code></pre></div><h5 id="以上1-5最终都会返回一个modelandview对象以上域对象的范围是page范围对于一些经常发生变动的数据比如列表数据库查询报错信息等需使用这种域对象">以上1-5最终都会返回一个ModelAndView对象，以上域对象的范围是page范围，对于一些经常发生变动的数据，比如列表，数据库查询，报错信息等，需使用这种域对象</h5>
<h4 id="7向session域共享数据">7.向session域共享数据</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testSession&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testSession</span><span style="color:#f92672">(</span>HttpSession session<span style="color:#f92672">){</span>
    session<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testSessionScope&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello,session&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--使用 session.属性键名 的方式来获取数据--&gt;</span>
<span style="color:#f92672">&lt;p</span> <span style="color:#a6e22e">th:text=</span><span style="color:#e6db74">&#34;${session.testSessionScope}&#34;</span><span style="color:#f92672">&gt;&lt;/p&gt;</span>
</code></pre></div><h5 id="session域对象常用来保存用户的登陆状态信息默认最长生存时间为30min">session域对象常用来保存用户的登陆状态信息，默认最长生存时间为30min</h5>
<h4 id="8向application域共享数据">8.向application域共享数据</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testApplication&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testApplication</span><span style="color:#f92672">(</span>HttpSession session<span style="color:#f92672">){</span>
    ServletContext application <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
    application<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;testApplicationScope&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;hello,application&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--使用 application.属性键名 的方式来获取数据--&gt;</span>
<span style="color:#f92672">&lt;p</span> <span style="color:#a6e22e">th:text=</span><span style="color:#e6db74">&#34;${application.testSessionScope}&#34;</span><span style="color:#f92672">&gt;&lt;/p&gt;</span>
</code></pre></div><hr>
<hr>
<p><a id="MVC-View">#</a></p>
<h3 id="六springmvc-视图">六、SpringMVC 视图</h3>
<p>SpringMVC中的视图是View接口，视图的作用渲染数据，将模型Model中的数据展示给用户</p>
<p>SpringMVC视图的种类很多，默认有转发视图和重定向视图</p>
<p>当工程引入jstl的依赖，转发视图会自动转换为JstlView</p>
<p>若使用的视图技术为Thymeleaf，在SpringMVC的配置文件中配置了Thymeleaf的视图解析器，由此视图解析器解析之后所得到的是ThymeleafView</p>
<h4 id="1-thymeleafview">1. ThymeleafView</h4>
<p>当控制器方法中所设置的视图名称没有任何前缀时，此时的视图名称会被SpringMVC配置文件中所配置的视图解析器解析，视图名称拼接视图前缀和视图后缀所得到的最终路径，会通过转发的方式实现跳转</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testThymeleafView&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testThymeleafView</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/imgs/ThymeleafView.png" alt="源码"></p>
<h4 id="2-转发视图">2. 转发视图</h4>
<p>SpringMVC中默认的转发视图是InternalResourceView</p>
<p>SpringMVC中创建转发视图的情况：</p>
<p>当控制器方法中所设置的视图名称以&quot;forward:&ldquo;为前缀时，创建InternalResourceView视图，此时的视图名称不会被SpringMVC配置文件中所配置的视图解析器解析，而是会将前缀&quot;forward:&ldquo;去掉，剩余部分作为最终路径通过转发的方式实现跳转</p>
<p>例如&quot;forward:/&quot;，“forward:/employee”</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testForward&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testForward</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;forward:/testThymeleafView&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">//浏览器地址栏显示 http://localhost:8080/springMVC/testForward
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p><img src="/imgs/InternalResourceView.png" alt=""></p>
<h4 id="3-重定向视图">3. 重定向视图</h4>
<p>SpringMVC中默认的重定向视图是RedirectView</p>
<p>当控制器方法中所设置的视图名称以&quot;redirect:&ldquo;为前缀时，创建RedirectView视图，此时的视图名称不会被SpringMVC配置文件中所配置的视图解析器解析，而是会将前缀&quot;redirect:&ldquo;去掉，剩余部分作为最终路径通过重定向的方式实现跳转</p>
<p>例如&quot;redirect:/&quot;，“redirect:/employee”</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testRedirect&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testRedirect</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;redirect:/testThymeleafView&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">//浏览器地址栏显示 http://localhost:8080/springMVC/testThymeleafView
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><p><img src="/imgs/RedirectView.png" alt=""></p>
<pre><code>注：

重定向视图在解析时，会先将redirect:前缀去掉，然后会判断剩余部分是否以/开头，若是则会自动拼接上下文路径
</code></pre><pre><code>重定向与转发的区别：
重定向是浏览器行为，转发是服务器行为
转发浏览器发送了一次请求，重定向浏览器发送了两次请求，第一次访问servlet，第二次访问重定向的地址
转发可以获取请求域中的数据，重定向不可以，因为两次请求两个request
转发可以访问WEB-INF中的资源，重定向不可以。WEB-INF中的资源具有安全性，只能通过服务器访问，不能通过浏览器访问
转发不可以跨域，重定向可以。转发是服务器内部行为，只能访问服务器内的资源，重定向可以访问外部资源
</code></pre><h4 id="4-视图控制器-view-controller">4. 视图控制器 view-controller</h4>
<p>当控制器方法中，仅仅用来实现页面跳转，即只需要设置视图名称时，可以将处理器方法使用view-controller标签进行表示</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">    path：设置处理的请求地址
</span><span style="color:#75715e">    view-name：设置请求地址所对应的视图名称
</span><span style="color:#75715e">--&gt;</span>
<span style="color:#f92672">&lt;mvc:view-controller</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;/testView&#34;</span> <span style="color:#a6e22e">view-name=</span><span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">&gt;&lt;/mvc:view-controller&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">注：

当SpringMVC中设置任何一个view-controller时，其他控制器中的请求映射将全部失效，此时需要在SpringMVC的核心配置文件中设置开启mvc注解驱动的标签：

<span style="color:#f92672">&lt;mvc:annotation-driven</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><h4 id="5internalresourceviewresolver">5.InternalResourceViewResolver</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!--springMVC.xml 中配置如下bean--&gt;</span>
&lt;<span style="color:#f92672">bean</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;org.springframework.web.servlet.view.InternalResourceViewResolver&#34;</span>&gt;
    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;prefix&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/WEB-INF/templates/&#34;</span>/&gt;
    &lt;<span style="color:#f92672">property</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;suffix&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;.jsp&#34;</span>/&gt;
&lt;/<span style="color:#f92672">bean</span>&gt;
</code></pre></div><pre><code class="language-jsp" data-lang="jsp">&lt;a href=&quot;${pageContext.request.contextPath}/success&quot;&gt;success.jsp&lt;/a&gt;
&lt;!--jsp通过 ${pageContext.request.contextPath} 的方式来获取上下文路径--&gt;
</code></pre><hr>
<hr>
<p><a id="RESTful">#</a></p>
<h3 id="七restful">七、RESTful</h3>
<p>RESTful是一种软件架构风格</p>
<h4 id="1-restful简介">1. RESTful简介</h4>
<p>REST：<strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer，表现层资源状态转移。</p>
<h5 id="资源">资源</h5>
<p>资源是一种看待服务器的方式，即，将服务器看作是由很多离散的资源组成。每个资源是服务器上一个可命名的抽象概念。因为资源是一个抽象的概念，所以它不仅仅能代表服务器文件系统中的一个文件、数据库中的一张表等等具体的东西，可以将资源设计的要多抽象有多抽象，只要想象力允许而且客户端应用开发者能够理解。与面向对象设计类似，资源是以名词为核心来组织的，首先关注的是名词。一个资源可以由一个或多个URI来标识。URI既是资源的名称，也是资源在Web上的地址。对某个资源感兴趣的客户端应用，可以通过资源的URI与其进行交互。</p>
<h5 id="资源的表述">资源的表述</h5>
<p>资源的表述是一段对于资源在某个特定时刻的状态的描述。可以在客户端-服务器端之间转移（交换）。资源的表述可以有多种格式，例如HTML/XML/JSON/纯文本/图片/视频/音频等等。资源的表述格式可以通过协商机制来确定。请求-响应方向的表述通常使用不同的格式。</p>
<h5 id="状态转移">状态转移</h5>
<p>状态转移说的是：在客户端和服务器端之间转移（transfer）代表资源状态的表述。通过转移和操作资源的表述，来间接实现操作资源的目的。</p>
<h4 id="2-restful的实现">2. RESTful的实现</h4>
<p>具体说，就是 HTTP 协议里面，四个表示操作方式的动词：GET、POST、PUT、DELETE。</p>
<p>它们分别对应四种基本操作：GET 用来获取资源，POST 用来新建资源，PUT 用来更新资源，DELETE 用来删除资源。</p>
<p>REST 风格提倡 URL 地址使用统一的风格设计，从前到后各个单词使用斜杠分开，不使用问号键值对方式携带请求参数，而是将要发送给服务器的数据作为 URL 地址的一部分，以保证整体风格的一致性。</p>
<table>
<thead>
<tr>
<th>操作</th>
<th>传统方式</th>
<th>REST风格</th>
</tr>
</thead>
<tbody>
<tr>
<td>查询操作</td>
<td>getUserById?id=1</td>
<td>user/1–&gt;get请求方式</td>
</tr>
<tr>
<td>保存操作</td>
<td>saveUser</td>
<td>user–&gt;post请求方式</td>
</tr>
<tr>
<td>删除操作</td>
<td>deleteUser?id=1</td>
<td>user/1–&gt;delete请求方式</td>
</tr>
<tr>
<td>更新操作</td>
<td>updateUser</td>
<td>user–&gt;put请求方式</td>
</tr>
</tbody>
</table>
<h4 id="3hiddenhttpmethodfilter">3.HiddenHttpMethodFilter</h4>
<p>由于浏览器只支持发送get和post方式的请求，那么该如何发送put和delete请求呢？</p>
<p>SpringMVC 提供了 <strong>HiddenHttpMethodFilter</strong> 帮助我们<strong>将 POST 请求转换为 DELETE 或 PUT 请求</strong></p>
<p><strong>HiddenHttpMethodFilter</strong> 处理put和delete请求的条件：</p>
<p>a&gt;当前请求的请求方式必须为post</p>
<p>b&gt;当前请求必须传输请求参数_method</p>
<p>满足以上条件，<strong>HiddenHttpMethodFilter</strong> 过滤器就会将当前请求的请求方式转换为请求参数_method的值，因此请求参数_method的值才是最终的请求方式</p>
<p>在web.xml中注册<strong>HiddenHttpMethodFilter</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;filter&gt;</span>
    <span style="color:#f92672">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span style="color:#f92672">&lt;/filter-name&gt;</span>
    <span style="color:#f92672">&lt;filter-class&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span style="color:#f92672">&lt;/filter-class&gt;</span>
<span style="color:#f92672">&lt;/filter&gt;</span>
<span style="color:#f92672">&lt;filter-mapping&gt;</span>
    <span style="color:#f92672">&lt;filter-name&gt;</span>HiddenHttpMethodFilter<span style="color:#f92672">&lt;/filter-name&gt;</span>
    <span style="color:#f92672">&lt;url-pattern&gt;</span>/*<span style="color:#f92672">&lt;/url-pattern&gt;</span>
<span style="color:#f92672">&lt;/filter-mapping&gt;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/user}&#34;</span>&gt;查询所有用户GET&lt;/<span style="color:#f92672">a</span>&gt;
&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/user/1}&#34;</span>&gt;查询指定用户GET&lt;/<span style="color:#f92672">a</span>&gt;

&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">th:action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/user}&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;添加用户POST&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">th:action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/user/1}&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_method&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;delete&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;删除指定用户DELETE&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">th:action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/user}&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hidden&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_method&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;put&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;更新用户PUT&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
</code></pre></div><pre><code>注：

目前为止，SpringMVC中提供了两个过滤器：CharacterEncodingFilter和HiddenHttpMethodFilter

在web.xml中注册时，必须先注册CharacterEncodingFilter，再注册HiddenHttpMethodFilter

原因：

* 在 CharacterEncodingFilter 中通过 request.setCharacterEncoding(encoding) 方法设置字符集的

* request.setCharacterEncoding(encoding) 方法要求前面不能有任何获取请求参数的操作

* 而 HiddenHttpMethodFilter 恰恰有一个获取请求方式的操作：
		String paramValue = request.getParameter(this.methodParam);
</code></pre><hr>
<hr>
<p><a id="HttpMessageConverter">#</a></p>
<h3 id="八httpmessageconverter">八、HttpMessageConverter</h3>
<p>HttpMessageConverter，报文信息转换器，将请求报文转换为Java对象，或将Java对象转换为响应报文</p>
<p>HttpMessageConverter提供了两个注解和两个类型：@RequestBody，@ResponseBody，RequestEntity，ResponseEntity</p>
<h4 id="1-requestbody">1. @RequestBody</h4>
<p>@RequestBody可以获取请求体，需要在控制器方法设置一个形参，使用@RequestBody进行标识，当前请求的请求体就会为当前注解所标识的形参赋值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">th:action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/testRequestBody}&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
    用户名：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;username&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
    密码：&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;password&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testRequestBody&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testRequestBody</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@RequestBody</span> String requestBody<span style="color:#f92672">){</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;requestBody:&#34;</span><span style="color:#f92672">+</span>requestBody<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>输出结果：</p>
<p>requestBody:username=admin&amp;password=123456</p>
<h4 id="2-requestentity">2. RequestEntity</h4>
<p>RequestEntity封装请求报文的一种类型，需要在控制器方法的形参中设置该类型的形参，当前请求的请求报文就会赋值给该形参，可以通过getHeaders()获取请求头信息，通过getBody()获取请求体信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testRequestEntity&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testRequestEntity</span><span style="color:#f92672">(</span>RequestEntity<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> requestEntity<span style="color:#f92672">){</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;requestHeader:&#34;</span><span style="color:#f92672">+</span>requestEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">getHeaders</span><span style="color:#f92672">());</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;requestBody:&#34;</span><span style="color:#f92672">+</span>requestEntity<span style="color:#f92672">.</span><span style="color:#a6e22e">getBody</span><span style="color:#f92672">());</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>输出结果： requestHeaders:[host:&ldquo;localhost:8080&rdquo;, connection:&ldquo;keep-alive&rdquo;, content-length:&ldquo;22&rdquo;, cache-control:&ldquo;max-age=0&rdquo;, sec-ch-ua:&ldquo;&ldquo;Microsoft Edge&rdquo;;v=&ldquo;107&rdquo;, &ldquo;Chromium&rdquo;;v=&ldquo;107&rdquo;, &ldquo;Not=A?Brand&rdquo;;v=&ldquo;24&quot;&rdquo;, sec-ch-ua-mobile:&quot;?0&rdquo;, sec-ch-ua-platform:&ldquo;&ldquo;Windows&rdquo;&rdquo;, upgrade-insecure-requests:&ldquo;1&rdquo;, origin:&ldquo;http://localhost:8080&rdquo;, user-agent:&ldquo;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.42&rdquo;, accept:&ldquo;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,<em>/</em>;q=0.8,application/signed-exchange;v=b3;q=0.9&rdquo;, sec-fetch-site:&ldquo;same-origin&rdquo;, sec-fetch-mode:&ldquo;navigate&rdquo;, sec-fetch-user:&quot;?1&rdquo;, sec-fetch-dest:&ldquo;document&rdquo;, referer:&ldquo;http://localhost:8080/springMVC/&rdquo;, accept-encoding:&ldquo;gzip, deflate, br&rdquo;, accept-language:&ldquo;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&rdquo;, cookie:&ldquo;JSESSIONID=CA7B35129A92ACEB35F415B0C177FBE2&rdquo;, Content-Type:&ldquo;application/x-www-form-urlencoded;charset=UTF-8&rdquo;]
requestBody:name=Jame&amp;password=123</p>
<h4 id="3-responsebody">3. @ResponseBody</h4>
<p>@ResponseBody用于标识一个控制器方法，可以将该方法的返回值直接作为响应报文的响应体响应到浏览器</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testResponseBody&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testResponseBody</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">//在原生servlet中可以使用 response.getWriter().print(&#34;    &#34;) 的方法
</span><span style="color:#75715e">//将print()中的参数作为响应体相应给浏览器
</span></code></pre></div><p>结果：浏览器页面显示success</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//@ResponseBody 返回中文时会乱码，在@RequestMapping()中配置属性produces
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span>
    value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/testResponseBody&#34;</span><span style="color:#f92672">,</span>
    produces <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;application/json;charset=utf-8&#34;</span>
<span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testResponseBody</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;成功&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="4-springmvc处理json">4. SpringMVC处理json</h4>
<p>SpringMVC处理json的步骤：</p>
<p><strong>1.导入jackson的依赖</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>jackson-databind<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>2.12.1<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p><strong>2.在SpringMVC的核心配置文件中开启mvc的注解驱动，此时在HandlerAdaptor中会自动装配一个消息转换器：MappingJackson2HttpMessageConverter，可以将响应到浏览器的Java对象转换为Json格式的字符串</strong></p>
<p><strong>3.在处理器方法上使用@ResponseBody注解进行标识</strong></p>
<p><strong>4.将Java对象直接作为控制器方法的返回值返回，就会自动转换为Json格式的字符串(不是json对象，是json格式的字符串，因为浏览器只能接受服务器发送的字符串)</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testResponseUser&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#66d9ef">public</span> User <span style="color:#a6e22e">testResponseUser</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> User<span style="color:#f92672">(</span>1001<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;admin&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;123456&#34;</span><span style="color:#f92672">,</span>23<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;男&#34;</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>浏览器的页面中展示的结果：</p>
<p>{“id”:1001,“username”:“admin”,“password”:“123456”,“age”:23,“sex”:“男”}</p>
<h4 id="5-springmvc处理ajax">5. SpringMVC处理ajax</h4>
<pre><code>ajax是一种用于创建更好更快以及交互性更强的Web应用程序的技术，能够快速将增量更新呈现在用户页面上，不需要重载整个页面(页面不刷新与服务器进行交互)，所以使用ajax，控制器不能使用转发和重定向来响应浏览器，而应使用@ResponseBody直接向浏览器相应数据
</code></pre><p>a&gt;请求超链接：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;app&#34;</span>&gt;
    &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">th:href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/testAjax}&#34;</span> <span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">click</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;testAjax&#34;</span>&gt;testAjax&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
&lt;/<span style="color:#f92672">div</span>&gt;
</code></pre></div><p>b&gt;通过vue和axios处理点击事件：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span> <span style="color:#a6e22e">th:src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/static/js/vue.js}&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span> <span style="color:#a6e22e">th:src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/static/js/axios.min.js}&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/javascript&#34;</span>&gt;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">vue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Vue</span>({
        <span style="color:#a6e22e">el</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;#app&#34;</span>,
        <span style="color:#a6e22e">methods</span><span style="color:#f92672">:</span>{
            <span style="color:#a6e22e">testAjax</span><span style="color:#f92672">:</span><span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">event</span>) {
                <span style="color:#a6e22e">axios</span>({
                    <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;post&#34;</span>,
                    <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span><span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">href</span>,
                    <span style="color:#a6e22e">params</span><span style="color:#f92672">:</span>{
                        <span style="color:#a6e22e">username</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;admin&#34;</span>,
                        <span style="color:#a6e22e">password</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#34;123456&#34;</span>
                    }
                }).<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">response</span>) {
                    <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">data</span>);
                });
                <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>();
            }
        }
    });
&lt;/<span style="color:#f92672">script</span>&gt;
</code></pre></div><p>c&gt;控制器方法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testAjax&#34;</span><span style="color:#f92672">)</span>
<span style="color:#a6e22e">@ResponseBody</span>
<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testAjax</span><span style="color:#f92672">(</span>String username<span style="color:#f92672">,</span> String password<span style="color:#f92672">){</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;username:&#34;</span><span style="color:#f92672">+</span>username<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;,password:&#34;</span><span style="color:#f92672">+</span>password<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;hello,ajax&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="6-restcontroller注解">6. @RestController注解</h4>
<p>@RestController注解是springMVC提供的一个复合注解，标识在控制器的类上，就相当于为类添加了@Controller注解，并且为其中的每个方法添加了@ResponseBody注解</p>
<h4 id="7-responseentity">7. ResponseEntity</h4>
<p>ResponseEntity用于控制器方法的返回值类型，该控制器方法的返回值就是响应到浏览器的响应报文</p>
<hr>
<hr>
<p><a id="Files">#</a></p>
<h3 id="九文件上传和下载">九、文件上传和下载</h3>
<h4 id="1-文件下载">1. 文件下载</h4>
<p>使用ResponseEntity实现下载文件的功能</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testDown&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]&gt;</span> <span style="color:#a6e22e">testResponseEntity</span><span style="color:#f92672">(</span>HttpSession session<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>
    <span style="color:#75715e">//获取ServletContext对象
</span><span style="color:#75715e"></span>    ServletContext servletContext <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
    <span style="color:#75715e">//获取服务器中文件的真实路径
</span><span style="color:#75715e"></span>    String realPath <span style="color:#f92672">=</span> servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/static/img/1.jpg&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//创建输入流
</span><span style="color:#75715e"></span>    InputStream is <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileInputStream<span style="color:#f92672">(</span>realPath<span style="color:#f92672">);</span>
    <span style="color:#75715e">//创建字节数组
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> bytes <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>is<span style="color:#f92672">.</span><span style="color:#a6e22e">available</span><span style="color:#f92672">()];</span>
    <span style="color:#75715e">//将流读到字节数组中
</span><span style="color:#75715e"></span>    is<span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>bytes<span style="color:#f92672">);</span>
    <span style="color:#75715e">//创建HttpHeaders对象设置响应头信息
</span><span style="color:#75715e"></span>    MultiValueMap<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> String<span style="color:#f92672">&gt;</span> headers <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HttpHeaders<span style="color:#f92672">();</span>
    <span style="color:#75715e">//设置要下载方式以及下载文件的名字
</span><span style="color:#75715e"></span>    headers<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Content-Disposition&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;attachment;filename=1.jpg&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#75715e">//设置响应状态码
</span><span style="color:#75715e"></span>    HttpStatus statusCode <span style="color:#f92672">=</span> HttpStatus<span style="color:#f92672">.</span><span style="color:#a6e22e">OK</span><span style="color:#f92672">;</span>
    <span style="color:#75715e">//创建ResponseEntity对象
</span><span style="color:#75715e"></span>    ResponseEntity<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">[]&gt;</span> responseEntity <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;(</span>bytes<span style="color:#f92672">,</span> headers<span style="color:#f92672">,</span> statusCode<span style="color:#f92672">);</span>
    <span style="color:#75715e">//关闭输入流
</span><span style="color:#75715e"></span>    is<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">return</span> responseEntity<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="2-文件上传">2. 文件上传</h4>
<p>文件上传要求form表单的请求方式必须为post，并且添加属性enctype=“multipart/form-data”</p>
<p>SpringMVC中将上传的文件封装到MultipartFile对象中，通过此对象可以获取文件相关信息</p>
<p>上传步骤：</p>
<p>a&gt;添加依赖：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span>
<span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>commons-fileupload<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>commons-fileupload<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.3.1<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p>b&gt;在SpringMVC的配置文件中添加配置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--必须通过文件解析器的解析才能将文件转换为MultipartFile对象，必须配置id属性，否则Spring找不到解析器--&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;multipartResolver&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.web.multipart.commons.CommonsMultipartResolver&#34;</span><span style="color:#f92672">&gt;&lt;/bean&gt;</span>
</code></pre></div><p>c&gt;html form表单</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">th:action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;@{/testUp}&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span> <span style="color:#a6e22e">enctype</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;multipart/form-data&#34;</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;file&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;photo&#34;</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;上传&#34;</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
</code></pre></div><p>d&gt;控制器方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@RequestMapping</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/testUp&#34;</span><span style="color:#f92672">)</span>
<span style="color:#75715e">//MultipartFile对象形参名要与表单中上传文件的name属性值一致
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">testUp</span><span style="color:#f92672">(</span>MultipartFile photo<span style="color:#f92672">,</span> HttpSession session<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> IOException <span style="color:#f92672">{</span>
    <span style="color:#75715e">//获取上传的文件的文件名
</span><span style="color:#75715e"></span>    String fileName <span style="color:#f92672">=</span> photo<span style="color:#f92672">.</span><span style="color:#a6e22e">getOriginalFilename</span><span style="color:#f92672">();</span>
    <span style="color:#75715e">//处理文件重名问题
</span><span style="color:#75715e"></span>    String suffixName <span style="color:#f92672">=</span> fileName<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>fileName<span style="color:#f92672">.</span><span style="color:#a6e22e">lastIndexOf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;.&#34;</span><span style="color:#f92672">));</span>
    <span style="color:#75715e">//UUID会返回一个128位的全局唯一标识，防止文件重名造成覆盖
</span><span style="color:#75715e"></span>    fileName <span style="color:#f92672">=</span> UUID<span style="color:#f92672">.</span><span style="color:#a6e22e">randomUUID</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> suffixName<span style="color:#f92672">;</span>
    <span style="color:#75715e">//获取服务器中photo目录的路径
</span><span style="color:#75715e"></span>    ServletContext servletContext <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">();</span>
    String photoPath <span style="color:#f92672">=</span> servletContext<span style="color:#f92672">.</span><span style="color:#a6e22e">getRealPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;photo&#34;</span><span style="color:#f92672">);</span>
    File file <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>photoPath<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span><span style="color:#f92672">(!</span>file<span style="color:#f92672">.</span><span style="color:#a6e22e">exists</span><span style="color:#f92672">()){</span>
        file<span style="color:#f92672">.</span><span style="color:#a6e22e">mkdir</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    String finalPath <span style="color:#f92672">=</span> photoPath <span style="color:#f92672">+</span> File<span style="color:#f92672">.</span><span style="color:#a6e22e">separator</span> <span style="color:#f92672">+</span> fileName<span style="color:#f92672">;</span>
    <span style="color:#75715e">//实现上传功能
</span><span style="color:#75715e"></span>    photo<span style="color:#f92672">.</span><span style="color:#a6e22e">transferTo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span>finalPath<span style="color:#f92672">));</span>
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;success&#34;</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><hr>
<hr>
<p><a id="Interceptor">#</a></p>
<h3 id="十拦截器">十、拦截器</h3>
<h4 id="1-拦截器的配置">1. 拦截器的配置</h4>
<p><strong>SpringMVC中的拦截器用于拦截控制器方法的执行</strong></p>
<p>SpringMVC中的拦截器需要实现HandlerInterceptor</p>
<p>SpringMVC的拦截器必须在SpringMVC的配置文件中进行配置：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 方法一，使用bean标签，此方法会拦截所有控制器方法--&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;com.atguigu.interceptor.FirstInterceptor&#34;</span><span style="color:#f92672">&gt;&lt;/bean&gt;</span>

<span style="color:#75715e">&lt;!-- 方法二，使用ref引用IoC容器中的bean，因此要将拦截器类设置为@Component普通组件，并ccs扫描该组件。此方法也会拦截所有控制器方法--&gt;</span>
<span style="color:#f92672">&lt;ref</span> <span style="color:#a6e22e">bean=</span><span style="color:#e6db74">&#34;firstInterceptor&#34;</span><span style="color:#f92672">&gt;&lt;/ref&gt;</span>
<span style="color:#75715e">&lt;!-- 以上两种配置方式都是对DispatcherServlet所处理的所有的请求进行拦截 --&gt;</span>

<span style="color:#75715e">&lt;!-- 方法三，--&gt;</span>
<span style="color:#f92672">&lt;mvc:interceptor&gt;</span>
    <span style="color:#f92672">&lt;mvc:mapping</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;/**&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#75715e">&lt;!-- 
</span><span style="color:#75715e">		此处使用/*只表示上下文路径中的一层路径，不能表示所有请求
</span><span style="color:#75715e">		要表示所有请求，使用/**
</span><span style="color:#75715e">	--&gt;</span>
    <span style="color:#f92672">&lt;mvc:exclude-mapping</span> <span style="color:#a6e22e">path=</span><span style="color:#e6db74">&#34;/testRequestEntity&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;ref</span> <span style="color:#a6e22e">bean=</span><span style="color:#e6db74">&#34;firstInterceptor&#34;</span><span style="color:#f92672">&gt;&lt;/ref&gt;</span>
<span style="color:#f92672">&lt;/mvc:interceptor&gt;</span>
<span style="color:#75715e">&lt;!-- 
</span><span style="color:#75715e">    以上配置方式可以通过ref或bean标签设置拦截器，通过mvc:mapping设置需要拦截的请求，通过mvc:exclude-mapping设置需要排除的请求，即不需要拦截的请求
</span><span style="color:#75715e">--&gt;</span>
</code></pre></div><h4 id="2-拦截器的三个抽象方法">2. 拦截器的三个抽象方法</h4>
<p>SpringMVC中的拦截器有三个抽象方法：</p>
<p>preHandle：控制器方法执行之前执行preHandle()，其boolean类型的返回值表示是否拦截或放行，返回true为放行，即调用控制器方法；返回false表示拦截，即不调用控制器方法</p>
<p>postHandle：控制器方法执行之后执行postHandle()</p>
<p>afterCompletion：处理完视图和模型数据，渲染视图完毕之后执行afterCompletion()</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FirstInterceptor</span> <span style="color:#66d9ef">implements</span> HandlerInterceptor <span style="color:#f92672">{</span>
    <span style="color:#75715e">//我们只能在pre对控制器方法进行拦截，所以只有preHandle方法返回值是bool
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">preHandle</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span> Object handler<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;FirstInterceptor -&gt; preHandle()...&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> HandlerInterceptor<span style="color:#f92672">.</span><span style="color:#a6e22e">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">preHandle</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> handler<span style="color:#f92672">);</span>
    	<span style="color:#75715e">//此处返回false，表示对控制器方法进行拦截，控制器方法将不再执行。
</span><span style="color:#75715e"></span>        <span style="color:#75715e">//返回true表示不拦截
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">postHandle</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span> Object handler<span style="color:#f92672">,</span> ModelAndView modelAndView<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;FirstInterceptor -&gt; postHandle()...&#34;</span><span style="color:#f92672">);</span>

        HandlerInterceptor<span style="color:#f92672">.</span><span style="color:#a6e22e">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">postHandle</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> handler<span style="color:#f92672">,</span> modelAndView<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">afterCompletion</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span> Object handler<span style="color:#f92672">,</span> Exception ex<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;FirstInterceptor -&gt; afterCompletion()...&#34;</span><span style="color:#f92672">);</span>

        HandlerInterceptor<span style="color:#f92672">.</span><span style="color:#a6e22e">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">afterCompletion</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> handler<span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/imgs/RequestProcess.png" alt="filter和interceptor对请求的处理"></p>
<h4 id="3-多个拦截器的执行顺序">3. 多个拦截器的执行顺序</h4>
<p><strong>a&gt;若每个拦截器的preHandle()都返回true</strong></p>
<p>此时多个拦截器的执行顺序和拦截器在SpringMVC的配置文件的配置顺序有关：</p>
<p>preHandle()会按照配置的顺序执行，而postHandle()和afterComplation()会按照配置的反序执行</p>
<p><strong>b&gt;若某个拦截器的preHandle()返回了false</strong></p>
<ul>
<li>
<p>返回false的preHandle()和它之前的拦截器的preHandle()都会执行；</p>
</li>
<li>
<p>所有的postHandle()都不执行；</p>
</li>
<li>
<p>返回false的拦截器之前的拦截器的afterComplation()会执行</p>
</li>
</ul>
<hr>
<hr>
<p><a id="ExceptionXeqtr">#</a></p>
<h3 id="十一异常处理器">十一、异常处理器</h3>
<h4 id="1-基于配置的异常处理">1. 基于配置的异常处理</h4>
<p>SpringMVC提供了一个处理控制器方法执行过程中所出现的异常的接口：HandlerExceptionResolver</p>
<p>HandlerExceptionResolver接口的实现类有：DefaultHandlerExceptionResolver和SimpleMappingExceptionResolver</p>
<p>SpringMVC提供了自定义的异常处理器SimpleMappingExceptionResolver，使用方式：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;exceptionMappings&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;props&gt;</span>
            <span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">                properties的键表示处理器方法执行过程中出现的异常
</span><span style="color:#75715e">                properties的值表示若出现指定异常时，设置一个新的视图名称，跳转到指定页面
</span><span style="color:#75715e">            --&gt;</span>
            <span style="color:#f92672">&lt;prop</span> <span style="color:#a6e22e">key=</span><span style="color:#e6db74">&#34;java.lang.ArithmeticException&#34;</span><span style="color:#f92672">&gt;</span>error<span style="color:#f92672">&lt;/prop&gt;</span>
        <span style="color:#f92672">&lt;/props&gt;</span>
    <span style="color:#f92672">&lt;/property&gt;</span>
    <span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">        exceptionAttribute属性设置一个属性名，将出现的异常信息在请求域中进行共享
</span><span style="color:#75715e">		value属性作为键值对的键，异常信息作为键值对的值
</span><span style="color:#75715e">    --&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;exceptionAttribute&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;ex&#34;</span><span style="color:#f92672">&gt;&lt;/property&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>
</code></pre></div><h4 id="2-基于注解的异常处理">2. 基于注解的异常处理</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//@ControllerAdvice将当前类标识为异常处理的组件
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@ControllerAdvice</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExceptionController</span> <span style="color:#f92672">{</span>

    <span style="color:#75715e">//@ExceptionHandler用于设置所标识方法处理的异常
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@ExceptionHandler</span><span style="color:#f92672">(</span>ArithmeticException<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
    <span style="color:#75715e">//ex表示当前请求处理中出现的异常对象
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">handleArithmeticException</span><span style="color:#f92672">(</span>Exception ex<span style="color:#f92672">,</span> Model model<span style="color:#f92672">){</span>
        model<span style="color:#f92672">.</span><span style="color:#a6e22e">addAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ex&#34;</span><span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;error&#34;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><hr>
<hr>
<p><a id="mvcAnno">#</a></p>
<h3 id="十二注解配置springmvc">十二、注解配置SpringMVC</h3>
<p>使用配置类和注解代替web.xml和SpringMVC配置文件的功能</p>
<h4 id="1-创建初始化类代替webxml">1. 创建初始化类，代替web.xml</h4>
<p>在Servlet3.0环境中，容器会在类路径中查找实现javax.servlet.ServletContainerInitializer接口的类，如果找到的话就用它来配置Servlet容器。 Spring提供了这个接口的实现，名为SpringServletContainerInitializer，这个类反过来又会查找实现WebApplicationInitializer的类并将配置的任务交给它们来完成。Spring3.2引入了一个便利的WebApplicationInitializer基础实现，名为AbstractAnnotationConfigDispatcherServletInitializer，当我们的类扩展了AbstractAnnotationConfigDispatcherServletInitializer并将其部署到Servlet3.0容器的时候，容器会自动发现它，并用它来配置Servlet上下文。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WebInit</span> <span style="color:#66d9ef">extends</span> AbstractAnnotationConfigDispatcherServletInitializer <span style="color:#f92672">{</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 指定spring的配置类
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> Class<span style="color:#f92672">&lt;?&gt;[]</span> getRootConfigClasses<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Class<span style="color:#f92672">[]{</span>SpringConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">};</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 指定SpringMVC的配置类
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> Class<span style="color:#f92672">&lt;?&gt;[]</span> getServletConfigClasses<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Class<span style="color:#f92672">[]{</span>WebConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">};</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 指定DispatcherServlet的映射规则，即url-pattern
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> String<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getServletMappings</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]{</span><span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">};</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">/**
</span><span style="color:#75715e">     * 添加过滤器
</span><span style="color:#75715e">     * @return
</span><span style="color:#75715e">     */</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">protected</span> Filter<span style="color:#f92672">[]</span> <span style="color:#a6e22e">getServletFilters</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        CharacterEncodingFilter encodingFilter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CharacterEncodingFilter<span style="color:#f92672">();</span>
        encodingFilter<span style="color:#f92672">.</span><span style="color:#a6e22e">setEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
        encodingFilter<span style="color:#f92672">.</span><span style="color:#a6e22e">setForceRequestEncoding</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
        HiddenHttpMethodFilter hiddenHttpMethodFilter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HiddenHttpMethodFilter<span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Filter<span style="color:#f92672">[]{</span>encodingFilter<span style="color:#f92672">,</span> hiddenHttpMethodFilter<span style="color:#f92672">};</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="2-创建springconfig配置类代替spring的配置文件">2. 创建SpringConfig配置类，代替spring的配置文件</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Configuration</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SpringConfig</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//ssm整合之后，spring的配置信息写在此类中
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><h4 id="3-创建webconfig配置类代替springmvc的配置文件">3. 创建WebConfig配置类，代替SpringMVC的配置文件</h4>
<ul>
<li>
<p>扫描组件</p>
</li>
<li>
<p>视图解析器</p>
</li>
<li>
<p>view-controller</p>
</li>
<li>
<p>default-servlet-handler</p>
</li>
<li>
<p>mvc注解驱动</p>
</li>
<li>
<p>文件上传解析器</p>
</li>
<li>
<p>异常处理</p>
</li>
<li>
<p>拦截器</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Configuration</span>
<span style="color:#75715e">//扫描组件
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@ComponentScan</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.atguigu.mvc.controller&#34;</span><span style="color:#f92672">)</span>
<span style="color:#75715e">//开启MVC注解驱动
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@EnableWebMvc</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">WebConfig</span> <span style="color:#66d9ef">implements</span> WebMvcConfigurer <span style="color:#f92672">{</span>

    <span style="color:#75715e">//使用默认的servlet处理静态资源
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">configureDefaultServletHandling</span><span style="color:#f92672">(</span>DefaultServletHandlerConfigurer configurer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        configurer<span style="color:#f92672">.</span><span style="color:#a6e22e">enable</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//配置文件上传解析器
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> CommonsMultipartResolver <span style="color:#a6e22e">multipartResolver</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> CommonsMultipartResolver<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//配置拦截器
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addInterceptors</span><span style="color:#f92672">(</span>InterceptorRegistry registry<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        FirstInterceptor firstInterceptor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FirstInterceptor<span style="color:#f92672">();</span>
        registry<span style="color:#f92672">.</span><span style="color:#a6e22e">addInterceptor</span><span style="color:#f92672">(</span>firstInterceptor<span style="color:#f92672">).</span><span style="color:#a6e22e">addPathPatterns</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/**&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
    <span style="color:#75715e">//配置视图控制
</span><span style="color:#75715e"></span>    
    <span style="color:#75715e">/*@Override
</span><span style="color:#75715e">    public void addViewControllers(ViewControllerRegistry registry) {
</span><span style="color:#75715e">        registry.addViewController(&#34;/&#34;).setViewName(&#34;index&#34;);
</span><span style="color:#75715e">    }*/</span>
    
    <span style="color:#75715e">//配置异常映射
</span><span style="color:#75715e"></span>    <span style="color:#75715e">/*@Override
</span><span style="color:#75715e">    public void configureHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) {
</span><span style="color:#75715e">        SimpleMappingExceptionResolver exceptionResolver = new SimpleMappingExceptionResolver();
</span><span style="color:#75715e">        Properties prop = new Properties();
</span><span style="color:#75715e">        prop.setProperty(&#34;java.lang.ArithmeticException&#34;, &#34;error&#34;);
</span><span style="color:#75715e">        //设置异常映射
</span><span style="color:#75715e">        exceptionResolver.setExceptionMappings(prop);
</span><span style="color:#75715e">        //设置共享异常信息的键
</span><span style="color:#75715e">        exceptionResolver.setExceptionAttribute(&#34;ex&#34;);
</span><span style="color:#75715e">        resolvers.add(exceptionResolver);
</span><span style="color:#75715e">    }*/</span>

    <span style="color:#75715e">//配置生成模板解析器
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> ITemplateResolver <span style="color:#a6e22e">templateResolver</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        WebApplicationContext webApplicationContext <span style="color:#f92672">=</span> ContextLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">getCurrentWebApplicationContext</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">// ServletContextTemplateResolver需要一个ServletContext作为构造参数，可通过WebApplicationContext 的方法获得
</span><span style="color:#75715e"></span>        ServletContextTemplateResolver templateResolver <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServletContextTemplateResolver<span style="color:#f92672">(</span>
                webApplicationContext<span style="color:#f92672">.</span><span style="color:#a6e22e">getServletContext</span><span style="color:#f92672">());</span>
        templateResolver<span style="color:#f92672">.</span><span style="color:#a6e22e">setPrefix</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/WEB-INF/templates/&#34;</span><span style="color:#f92672">);</span>
        templateResolver<span style="color:#f92672">.</span><span style="color:#a6e22e">setSuffix</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;.html&#34;</span><span style="color:#f92672">);</span>
        templateResolver<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
        templateResolver<span style="color:#f92672">.</span><span style="color:#a6e22e">setTemplateMode</span><span style="color:#f92672">(</span>TemplateMode<span style="color:#f92672">.</span><span style="color:#a6e22e">HTML</span><span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> templateResolver<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//生成模板引擎并为模板引擎注入模板解析器
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> SpringTemplateEngine <span style="color:#a6e22e">templateEngine</span><span style="color:#f92672">(</span>ITemplateResolver templateResolver<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        SpringTemplateEngine templateEngine <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SpringTemplateEngine<span style="color:#f92672">();</span>
        templateEngine<span style="color:#f92672">.</span><span style="color:#a6e22e">setTemplateResolver</span><span style="color:#f92672">(</span>templateResolver<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> templateEngine<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">//生成视图解析器并未解析器注入模板引擎
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> ViewResolver <span style="color:#a6e22e">viewResolver</span><span style="color:#f92672">(</span>SpringTemplateEngine templateEngine<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        ThymeleafViewResolver viewResolver <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ThymeleafViewResolver<span style="color:#f92672">();</span>
        viewResolver<span style="color:#f92672">.</span><span style="color:#a6e22e">setCharacterEncoding</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">);</span>
        viewResolver<span style="color:#f92672">.</span><span style="color:#a6e22e">setTemplateEngine</span><span style="color:#f92672">(</span>templateEngine<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> viewResolver<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><hr>
<hr>
<p><a id="mvcSource">#</a></p>
<h3 id="十三springmvc执行流程">十三、SpringMVC执行流程</h3>
<h4 id="1-springmvc常用组件">1. SpringMVC常用组件</h4>
<ul>
<li>DispatcherServlet：<strong>前端控制器</strong>，不需要工程师开发，由框架提供</li>
</ul>
<p>作用：统一处理请求和响应，整个流程控制的中心，由它调用其它组件处理用户的请求</p>
<ul>
<li>HandlerMapping：<strong>处理器映射器</strong>，不需要工程师开发，由框架提供</li>
</ul>
<p>作用：根据请求的url、method等信息查找Handler，即控制器方法</p>
<ul>
<li>Handler：<strong>处理器</strong>，需要工程师开发</li>
</ul>
<p>作用：在DispatcherServlet的控制下Handler对具体的用户请求进行处理</p>
<ul>
<li>HandlerAdapter：<strong>处理器适配器</strong>，不需要工程师开发，由框架提供</li>
</ul>
<p>作用：通过HandlerAdapter对处理器（控制器方法）进行执行</p>
<ul>
<li>ViewResolver：<strong>视图解析器</strong>，不需要工程师开发，由框架提供</li>
</ul>
<p>作用：进行视图解析，得到相应的视图，例如：ThymeleafView、InternalResourceView、RedirectView</p>
<ul>
<li>View：<strong>视图</strong></li>
</ul>
<p>作用：将模型数据通过页面展示给用户</p>
<h4 id="2-dispatcherservlet初始化过程">2. DispatcherServlet初始化过程</h4>
<p>DispatcherServlet 本质上是一个 Servlet，所以天然的遵循 Servlet 的生命周期。所以宏观上是 Servlet 生命周期来进行调度。</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-kphToPhs-1627992919015)(img/img005.png)]</p>
<h5 id="a初始化webapplicationcontext">a&gt;初始化WebApplicationContext</h5>
<p>所在类：org.springframework.web.servlet.FrameworkServlet</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> WebApplicationContext <span style="color:#a6e22e">initWebApplicationContext</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    WebApplicationContext rootContext <span style="color:#f92672">=</span>
        WebApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getWebApplicationContext</span><span style="color:#f92672">(</span>getServletContext<span style="color:#f92672">());</span>
    WebApplicationContext wac <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">webApplicationContext</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// A context instance was injected at construction time -&gt; use it
</span><span style="color:#75715e"></span>        wac <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">webApplicationContext</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>wac <span style="color:#66d9ef">instanceof</span> ConfigurableWebApplicationContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            ConfigurableWebApplicationContext cwac <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ConfigurableWebApplicationContext<span style="color:#f92672">)</span> wac<span style="color:#f92672">;</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">isActive</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">// The context has not yet been refreshed -&gt; provide services such as
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// setting the parent context, setting the application context id, etc
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">getParent</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">// The context instance was injected without an explicit parent -&gt; set
</span><span style="color:#75715e"></span>                    <span style="color:#75715e">// the root application context (if any; may be null) as the parent
</span><span style="color:#75715e"></span>                    cwac<span style="color:#f92672">.</span><span style="color:#a6e22e">setParent</span><span style="color:#f92672">(</span>rootContext<span style="color:#f92672">);</span>
                <span style="color:#f92672">}</span>
                configureAndRefreshWebApplicationContext<span style="color:#f92672">(</span>cwac<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>wac <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// No context instance was injected at construction time -&gt; see if one
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// has been registered in the servlet context. If one exists, it is assumed
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// that the parent context (if any) has already been set and that the
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// user has performed any initialization such as setting the context id
</span><span style="color:#75715e"></span>        wac <span style="color:#f92672">=</span> findWebApplicationContext<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>wac <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// No context instance is defined for this servlet -&gt; create a local one
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// 创建WebApplicationContext
</span><span style="color:#75715e"></span>        wac <span style="color:#f92672">=</span> createWebApplicationContext<span style="color:#f92672">(</span>rootContext<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">refreshEventReceived</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Either the context is not a ConfigurableApplicationContext with refresh
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// support or the context injected at construction time had already been
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// refreshed -&gt; trigger initial onRefresh manually here.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onRefreshMonitor</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// 刷新WebApplicationContext
</span><span style="color:#75715e"></span>            onRefresh<span style="color:#f92672">(</span>wac<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">publishContext</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Publish the context as a servlet context attribute.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// 将IOC容器在应用域共享
</span><span style="color:#75715e"></span>        String attrName <span style="color:#f92672">=</span> getServletContextAttributeName<span style="color:#f92672">();</span>
        getServletContext<span style="color:#f92672">().</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>attrName<span style="color:#f92672">,</span> wac<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> wac<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="创建webapplicationcontext">创建WebApplicationContext</h5>
<p>所在类：org.springframework.web.servlet.FrameworkServlet</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> WebApplicationContext <span style="color:#a6e22e">createWebApplicationContext</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Nullable</span> ApplicationContext parent<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Class<span style="color:#f92672">&lt;?&gt;</span> contextClass <span style="color:#f92672">=</span> getContextClass<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>ConfigurableWebApplicationContext<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isAssignableFrom</span><span style="color:#f92672">(</span>contextClass<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ApplicationContextException<span style="color:#f92672">(</span>
            <span style="color:#e6db74">&#34;Fatal initialization error in servlet with name &#39;&#34;</span> <span style="color:#f92672">+</span> getServletName<span style="color:#f92672">()</span> <span style="color:#f92672">+</span>
            <span style="color:#e6db74">&#34;&#39;: custom WebApplicationContext class [&#34;</span> <span style="color:#f92672">+</span> contextClass<span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span>
            <span style="color:#e6db74">&#34;] is not of type ConfigurableWebApplicationContext&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#75715e">// 通过反射创建 IOC 容器对象
</span><span style="color:#75715e"></span>    ConfigurableWebApplicationContext wac <span style="color:#f92672">=</span>
        <span style="color:#f92672">(</span>ConfigurableWebApplicationContext<span style="color:#f92672">)</span> BeanUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">instantiateClass</span><span style="color:#f92672">(</span>contextClass<span style="color:#f92672">);</span>

    wac<span style="color:#f92672">.</span><span style="color:#a6e22e">setEnvironment</span><span style="color:#f92672">(</span>getEnvironment<span style="color:#f92672">());</span>
    <span style="color:#75715e">// 设置父容器
</span><span style="color:#75715e"></span>    wac<span style="color:#f92672">.</span><span style="color:#a6e22e">setParent</span><span style="color:#f92672">(</span>parent<span style="color:#f92672">);</span>
    String configLocation <span style="color:#f92672">=</span> getContextConfigLocation<span style="color:#f92672">();</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>configLocation <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        wac<span style="color:#f92672">.</span><span style="color:#a6e22e">setConfigLocation</span><span style="color:#f92672">(</span>configLocation<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    configureAndRefreshWebApplicationContext<span style="color:#f92672">(</span>wac<span style="color:#f92672">);</span>

    <span style="color:#66d9ef">return</span> wac<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="cdispatcherservlet初始化策略">c&gt;DispatcherServlet初始化策略</h5>
<p>FrameworkServlet创建WebApplicationContext后，刷新容器，调用onRefresh(wac)，此方法在DispatcherServlet中进行了重写，调用了initStrategies(context)方法，初始化策略，即初始化DispatcherServlet的各个组件</p>
<p>所在类：org.springframework.web.servlet.DispatcherServlet</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">initStrategies</span><span style="color:#f92672">(</span>ApplicationContext context<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
   initMultipartResolver<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
   initLocaleResolver<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
   initThemeResolver<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
   initHandlerMappings<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
   initHandlerAdapters<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
   initHandlerExceptionResolvers<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
   initRequestToViewNameTranslator<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
   initViewResolvers<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
   initFlashMapManager<span style="color:#f92672">(</span>context<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="3-dispatcherservlet调用组件处理请求">3. DispatcherServlet调用组件处理请求</h4>
<h5 id="aprocessrequest">a&gt;processRequest()</h5>
<p>FrameworkServlet重写HttpServlet中的service()和doXxx()，这些方法中调用了processRequest(request, response)</p>
<p>所在类：org.springframework.web.servlet.FrameworkServlet</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">processRequest</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">throws</span> ServletException<span style="color:#f92672">,</span> IOException <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">long</span> startTime <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
    Throwable failureCause <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

    LocaleContext previousLocaleContext <span style="color:#f92672">=</span> LocaleContextHolder<span style="color:#f92672">.</span><span style="color:#a6e22e">getLocaleContext</span><span style="color:#f92672">();</span>
    LocaleContext localeContext <span style="color:#f92672">=</span> buildLocaleContext<span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>

    RequestAttributes previousAttributes <span style="color:#f92672">=</span> RequestContextHolder<span style="color:#f92672">.</span><span style="color:#a6e22e">getRequestAttributes</span><span style="color:#f92672">();</span>
    ServletRequestAttributes requestAttributes <span style="color:#f92672">=</span> buildRequestAttributes<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> previousAttributes<span style="color:#f92672">);</span>

    WebAsyncManager asyncManager <span style="color:#f92672">=</span> WebAsyncUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getAsyncManager</span><span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>
    asyncManager<span style="color:#f92672">.</span><span style="color:#a6e22e">registerCallableInterceptor</span><span style="color:#f92672">(</span>FrameworkServlet<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(),</span> <span style="color:#66d9ef">new</span> RequestBindingInterceptor<span style="color:#f92672">());</span>

    initContextHolders<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> localeContext<span style="color:#f92672">,</span> requestAttributes<span style="color:#f92672">);</span>

    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 执行服务，doService()是一个抽象方法，在DispatcherServlet中进行了重写
</span><span style="color:#75715e"></span>        doService<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>ServletException <span style="color:#f92672">|</span> IOException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        failureCause <span style="color:#f92672">=</span> ex<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">throw</span> ex<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        failureCause <span style="color:#f92672">=</span> ex<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> NestedServletException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Request processing failed&#34;</span><span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        resetContextHolders<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> previousLocaleContext<span style="color:#f92672">,</span> previousAttributes<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>requestAttributes <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            requestAttributes<span style="color:#f92672">.</span><span style="color:#a6e22e">requestCompleted</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        logResult<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> failureCause<span style="color:#f92672">,</span> asyncManager<span style="color:#f92672">);</span>
        publishRequestHandledEvent<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> startTime<span style="color:#f92672">,</span> failureCause<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="bdoservice">b&gt;doService()</h5>
<p>所在类：org.springframework.web.servlet.DispatcherServlet</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doService</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
    logRequest<span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>

    <span style="color:#75715e">// Keep a snapshot of the request attributes in case of an include,
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// to be able to restore the original attributes after the include.
</span><span style="color:#75715e"></span>    Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> attributesSnapshot <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">isIncludeRequest</span><span style="color:#f92672">(</span>request<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        attributesSnapshot <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>
        Enumeration<span style="color:#f92672">&lt;?&gt;</span> attrNames <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttributeNames</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>attrNames<span style="color:#f92672">.</span><span style="color:#a6e22e">hasMoreElements</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            String attrName <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span> attrNames<span style="color:#f92672">.</span><span style="color:#a6e22e">nextElement</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">cleanupAfterInclude</span> <span style="color:#f92672">||</span> attrName<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWith</span><span style="color:#f92672">(</span>DEFAULT_STRATEGIES_PREFIX<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                attributesSnapshot<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>attrName<span style="color:#f92672">,</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span>attrName<span style="color:#f92672">));</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// Make framework objects available to handlers and view objects.
</span><span style="color:#75715e"></span>    request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>WEB_APPLICATION_CONTEXT_ATTRIBUTE<span style="color:#f92672">,</span> getWebApplicationContext<span style="color:#f92672">());</span>
    request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>LOCALE_RESOLVER_ATTRIBUTE<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">localeResolver</span><span style="color:#f92672">);</span>
    request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>THEME_RESOLVER_ATTRIBUTE<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">themeResolver</span><span style="color:#f92672">);</span>
    request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>THEME_SOURCE_ATTRIBUTE<span style="color:#f92672">,</span> getThemeSource<span style="color:#f92672">());</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">flashMapManager</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        FlashMap inputFlashMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">flashMapManager</span><span style="color:#f92672">.</span><span style="color:#a6e22e">retrieveAndUpdate</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>inputFlashMap <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>INPUT_FLASH_MAP_ATTRIBUTE<span style="color:#f92672">,</span> Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">unmodifiableMap</span><span style="color:#f92672">(</span>inputFlashMap<span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>
        request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>OUTPUT_FLASH_MAP_ATTRIBUTE<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> FlashMap<span style="color:#f92672">());</span>
        request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span>FLASH_MAP_MANAGER_ATTRIBUTE<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">flashMapManager</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    RequestPath requestPath <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">parseRequestPath</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>ServletRequestPathUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">hasParsedRequestPath</span><span style="color:#f92672">(</span>request<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        requestPath <span style="color:#f92672">=</span> ServletRequestPathUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">parseAndCache</span><span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 处理请求和响应
</span><span style="color:#75715e"></span>        doDispatch<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>WebAsyncUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getAsyncManager</span><span style="color:#f92672">(</span>request<span style="color:#f92672">).</span><span style="color:#a6e22e">isConcurrentHandlingStarted</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// Restore the original attribute snapshot, in case of an include.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>attributesSnapshot <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                restoreAttributesAfterInclude<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> attributesSnapshot<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>requestPath <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            ServletRequestPathUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">clearParsedRequestPath</span><span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="cdodispatch">c&gt;doDispatch()</h5>
<p>所在类：org.springframework.web.servlet.DispatcherServlet</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">doDispatch</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
    HttpServletRequest processedRequest <span style="color:#f92672">=</span> request<span style="color:#f92672">;</span>
    HandlerExecutionChain mappedHandler <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">boolean</span> multipartRequestParsed <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>

    WebAsyncManager asyncManager <span style="color:#f92672">=</span> WebAsyncUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getAsyncManager</span><span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>

    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        ModelAndView mv <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        Exception dispatchException <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            processedRequest <span style="color:#f92672">=</span> checkMultipart<span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>
            multipartRequestParsed <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>processedRequest <span style="color:#f92672">!=</span> request<span style="color:#f92672">);</span>

            <span style="color:#75715e">// Determine handler for the current request.
</span><span style="color:#75715e"></span>            <span style="color:#75715e">/*
</span><span style="color:#75715e">                mappedHandler：调用链
</span><span style="color:#75715e">                包含handler、interceptorList、interceptorIndex
</span><span style="color:#75715e">                handler：浏览器发送的请求所匹配的控制器方法
</span><span style="color:#75715e">                interceptorList：处理控制器方法的所有拦截器集合
</span><span style="color:#75715e">                interceptorIndex：拦截器索引，控制拦截器afterCompletion()的执行
</span><span style="color:#75715e">            */</span>
            mappedHandler <span style="color:#f92672">=</span> getHandler<span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mappedHandler <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                noHandlerFound<span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
                <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>

            <span style="color:#75715e">// Determine handler adapter for the current request.
</span><span style="color:#75715e"></span>               <span style="color:#75715e">// 通过控制器方法创建相应的处理器适配器，调用所对应的控制器方法
</span><span style="color:#75715e"></span>            HandlerAdapter ha <span style="color:#f92672">=</span> getHandlerAdapter<span style="color:#f92672">(</span>mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">getHandler</span><span style="color:#f92672">());</span>

            <span style="color:#75715e">// Process last-modified header, if supported by the handler.
</span><span style="color:#75715e"></span>            String method <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span><span style="color:#a6e22e">getMethod</span><span style="color:#f92672">();</span>
            <span style="color:#66d9ef">boolean</span> isGet <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GET&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>method<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isGet <span style="color:#f92672">||</span> <span style="color:#e6db74">&#34;HEAD&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>method<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">long</span> lastModified <span style="color:#f92672">=</span> ha<span style="color:#f92672">.</span><span style="color:#a6e22e">getLastModified</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">getHandler</span><span style="color:#f92672">());</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ServletWebRequest<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">).</span><span style="color:#a6e22e">checkNotModified</span><span style="color:#f92672">(</span>lastModified<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> isGet<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
            
            <span style="color:#75715e">// 调用拦截器的preHandle()
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">applyPreHandle</span><span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>

            <span style="color:#75715e">// Actually invoke the handler.
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// 由处理器适配器调用具体的控制器方法，最终获得ModelAndView对象
</span><span style="color:#75715e"></span>            mv <span style="color:#f92672">=</span> ha<span style="color:#f92672">.</span><span style="color:#a6e22e">handle</span><span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">getHandler</span><span style="color:#f92672">());</span>

            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>asyncManager<span style="color:#f92672">.</span><span style="color:#a6e22e">isConcurrentHandlingStarted</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>

            applyDefaultViewName<span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> mv<span style="color:#f92672">);</span>
            <span style="color:#75715e">// 调用拦截器的postHandle()
</span><span style="color:#75715e"></span>            mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">applyPostHandle</span><span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> mv<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            dispatchException <span style="color:#f92672">=</span> ex<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable err<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// As of 4.3, we&#39;re processing Errors thrown from handler methods as well,
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// making them available for @ExceptionHandler methods and other scenarios.
</span><span style="color:#75715e"></span>            dispatchException <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> NestedServletException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Handler dispatch failed&#34;</span><span style="color:#f92672">,</span> err<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// 后续处理：处理模型数据和渲染视图
</span><span style="color:#75715e"></span>        processDispatchResult<span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> mappedHandler<span style="color:#f92672">,</span> mv<span style="color:#f92672">,</span> dispatchException<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        triggerAfterCompletion<span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> mappedHandler<span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable err<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        triggerAfterCompletion<span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> mappedHandler<span style="color:#f92672">,</span>
                               <span style="color:#66d9ef">new</span> NestedServletException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Handler processing failed&#34;</span><span style="color:#f92672">,</span> err<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>asyncManager<span style="color:#f92672">.</span><span style="color:#a6e22e">isConcurrentHandlingStarted</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// Instead of postHandle and afterCompletion
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mappedHandler <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">applyAfterConcurrentHandlingStarted</span><span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// Clean up any resources used by a multipart request.
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>multipartRequestParsed<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                cleanupMultipart<span style="color:#f92672">(</span>processedRequest<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h5 id="dprocessdispatchresult">d&gt;processDispatchResult()</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">processDispatchResult</span><span style="color:#f92672">(</span>HttpServletRequest request<span style="color:#f92672">,</span> HttpServletResponse response<span style="color:#f92672">,</span>
                                   <span style="color:#a6e22e">@Nullable</span> HandlerExecutionChain mappedHandler<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> ModelAndView mv<span style="color:#f92672">,</span>
                                   <span style="color:#a6e22e">@Nullable</span> Exception exception<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">boolean</span> errorView <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exception <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>exception <span style="color:#66d9ef">instanceof</span> ModelAndViewDefiningException<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            logger<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ModelAndViewDefiningException encountered&#34;</span><span style="color:#f92672">,</span> exception<span style="color:#f92672">);</span>
            mv <span style="color:#f92672">=</span> <span style="color:#f92672">((</span>ModelAndViewDefiningException<span style="color:#f92672">)</span> exception<span style="color:#f92672">).</span><span style="color:#a6e22e">getModelAndView</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            Object handler <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>mappedHandler <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">getHandler</span><span style="color:#f92672">()</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
            mv <span style="color:#f92672">=</span> processHandlerException<span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> handler<span style="color:#f92672">,</span> exception<span style="color:#f92672">);</span>
            errorView <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>mv <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// Did the handler return a view to render?
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mv <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>mv<span style="color:#f92672">.</span><span style="color:#a6e22e">wasCleared</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// 处理模型数据和渲染视图
</span><span style="color:#75715e"></span>        render<span style="color:#f92672">(</span>mv<span style="color:#f92672">,</span> request<span style="color:#f92672">,</span> response<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>errorView<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            WebUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">clearErrorRequestAttributes</span><span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isTraceEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            logger<span style="color:#f92672">.</span><span style="color:#a6e22e">trace</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;No view rendering, null ModelAndView returned.&#34;</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>WebAsyncUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getAsyncManager</span><span style="color:#f92672">(</span>request<span style="color:#f92672">).</span><span style="color:#a6e22e">isConcurrentHandlingStarted</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Concurrent handling started during a forward
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mappedHandler <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Exception (if any) is already handled..
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// 调用拦截器的afterCompletion()
</span><span style="color:#75715e"></span>        mappedHandler<span style="color:#f92672">.</span><span style="color:#a6e22e">triggerAfterCompletion</span><span style="color:#f92672">(</span>request<span style="color:#f92672">,</span> response<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="4-springmvc的执行流程">4. SpringMVC的执行流程</h4>
<ol>
<li>用户向服务器发送请求，请求被SpringMVC 前端控制器 DispatcherServlet捕获。</li>
<li>DispatcherServlet对请求URL进行解析，得到请求资源标识符（URI），判断请求URI对应的映射：</li>
</ol>
<p>a) 不存在</p>
<p>i. 再判断是否配置了mvc:default-servlet-handler</p>
<p>ii. 如果没配置，则控制台报映射查找不到，客户端展示404错误</p>
<p>iii. 如果有配置，则访问目标资源（一般为静态资源，如：JS,CSS,HTML），找不到客户端也会展示404错误</p>
<p>b) 存在则执行下面的流程</p>
<ol>
<li>根据该URI，调用HandlerMapping获得该Handler配置的所有相关的对象（包括Handler对象以及Handler对象对应的拦截器），最后以HandlerExecutionChain执行链对象的形式返回。</li>
<li>DispatcherServlet 根据获得的Handler，选择一个合适的HandlerAdapter。</li>
<li>如果成功获得HandlerAdapter，此时将开始执行拦截器的preHandler(…)方法【正向】</li>
<li>提取Request中的模型数据，填充Handler入参，开始执行Handler（Controller)方法，处理请求。在填充Handler的入参过程中，根据你的配置，Spring将帮你做一些额外的工作：</li>
</ol>
<p>a) HttpMessageConveter： 将请求消息（如Json、xml等数据）转换成一个对象，将对象转换为指定的响应信息</p>
<p>b) 数据转换：对请求消息进行数据转换。如String转换成Integer、Double等</p>
<p>c) 数据格式化：对请求消息进行数据格式化。 如将字符串转换成格式化数字或格式化日期等</p>
<p>d) 数据验证： 验证数据的有效性（长度、格式等），验证结果存储到BindingResult或Error中</p>
<ol>
<li>Handler执行完成后，向DispatcherServlet 返回一个ModelAndView对象。</li>
<li>此时将开始执行拦截器的postHandle(…)方法【逆向】。</li>
<li>根据返回的ModelAndView（此时会判断是否存在异常：如果存在异常，则执行HandlerExceptionResolver进行异常处理）选择一个适合的ViewResolver进行视图解析，根据Model和View，来渲染视图。</li>
<li>渲染视图完毕执行拦截器的afterCompletion(…)方法【逆向】。</li>
<li>将渲染结果返回给客户端。</li>
</ol>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
