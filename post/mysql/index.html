<!doctype html>
<html lang="en-us">
  <head>
    <title>MySQL // Sp(act)rum</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="冯雪洋" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://sherry-long.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MySQL"/>
<meta name="twitter:description" content="MySQL基础
​	SELECT
​	运算符-符号与关键字
​	ORDERBY
​	分页
​	多表查询-内连外连、UNION
​	SQL99新特性
​	单行函数
​	聚合函数与GROUPBY、HAVING
​	SQL执行流程
​	子查询
#
SELECT相关 列与表的别名 # 字段名 别名 SELECT emp_name eName FROM t_emp; # 字段名 AS 别名 （AS ~ AliaS） SELECT emp_name AS eName FROM t_emp; # 字段名 &#34;别名&#34; （当别名中含有 空格 时，必须使用此方法） SELECT emp_name &#34;eName&#34; FROM t_emp; # 表名 别名 SELECT emp_name FROM t_emp emp; # 如果给表起了别名，在SELECT和WHERE中必须使用别名，否则会报错 去重 # 只保留一个符合条件的结果 SELECT DISTINCT * FROM t_emp WHERE emp_name = &#39;赵&#39; 着重号 `` # 当表名或字段名与关键字发生冲突时，使用 `` 来区分 SELECT * FROM `order` 查询常数 SELECT &#39;字符串&#39;, 123, emp_name, age FROM t_emp 显示表结构 DESC t_emp DESCRIBE t_emp   #"/>

    <meta property="og:title" content="MySQL" />
<meta property="og:description" content="MySQL基础
​	SELECT
​	运算符-符号与关键字
​	ORDERBY
​	分页
​	多表查询-内连外连、UNION
​	SQL99新特性
​	单行函数
​	聚合函数与GROUPBY、HAVING
​	SQL执行流程
​	子查询
#
SELECT相关 列与表的别名 # 字段名 别名 SELECT emp_name eName FROM t_emp; # 字段名 AS 别名 （AS ~ AliaS） SELECT emp_name AS eName FROM t_emp; # 字段名 &#34;别名&#34; （当别名中含有 空格 时，必须使用此方法） SELECT emp_name &#34;eName&#34; FROM t_emp; # 表名 别名 SELECT emp_name FROM t_emp emp; # 如果给表起了别名，在SELECT和WHERE中必须使用别名，否则会报错 去重 # 只保留一个符合条件的结果 SELECT DISTINCT * FROM t_emp WHERE emp_name = &#39;赵&#39; 着重号 `` # 当表名或字段名与关键字发生冲突时，使用 `` 来区分 SELECT * FROM `order` 查询常数 SELECT &#39;字符串&#39;, 123, emp_name, age FROM t_emp 显示表结构 DESC t_emp DESCRIBE t_emp   #" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sherry-long.github.io/post/mysql/" />
<meta property="article:published_time" content="2023-02-21T11:39:54+08:00" />
<meta property="article:modified_time" content="2023-02-21T11:39:54+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://sherry-long.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="冯雪洋" /></a>
      <h1>Sp(act)rum</h1>
      <p>这个人很懒，什么介绍都没留下</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/Sherry-long" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
          <a target="_blank" href="https://space.bilibili.com/13547597" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link">
  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
  <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">MySQL</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Feb 21, 2023
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          8 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p><a href="#MySQLstarter">MySQL基础</a></p>
<p>​	<a href="#MySQLstarter">SELECT</a></p>
<p>​	<a href="#op">运算符-符号与关键字</a></p>
<p>​	<a href="#ORDERBY">ORDERBY</a></p>
<p>​	<a href="#PageSplit">分页</a></p>
<p>​	<a href="#MultiTableQuery">多表查询-内连外连、UNION</a></p>
<p>​	<a href="#SQL99newFeature">SQL99新特性</a></p>
<p>​	<a href="#SingleLineFunction">单行函数</a></p>
<p>​	<a href="#AggregateFunctions">聚合函数与GROUPBY、HAVING</a></p>
<p>​	<a href="#SQLexqtProcess">SQL执行流程</a></p>
<p>​	<a href="#SubQuery">子查询</a></p>
<p><a id="MySQLstarter">#</a></p>
<h3 id="select相关">SELECT相关</h3>
<h4 id="列与表的别名">列与表的别名</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#960050;background-color:#1e0010">别名</span>
<span style="color:#66d9ef">SELECT</span> emp_name eName <span style="color:#66d9ef">FROM</span> t_emp;
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">别名</span> <span style="color:#960050;background-color:#1e0010">（</span><span style="color:#66d9ef">AS</span> <span style="color:#f92672">~</span> <span style="color:#66d9ef">AliaS</span><span style="color:#960050;background-color:#1e0010">）</span>
<span style="color:#66d9ef">SELECT</span> emp_name <span style="color:#66d9ef">AS</span> eName <span style="color:#66d9ef">FROM</span> t_emp;
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">字段名</span> <span style="color:#e6db74">&#34;别名&#34;</span> <span style="color:#960050;background-color:#1e0010">（当别名中含有</span> <span style="color:#960050;background-color:#1e0010">空格</span> <span style="color:#960050;background-color:#1e0010">时，必须使用此方法）</span>
<span style="color:#66d9ef">SELECT</span> emp_name <span style="color:#e6db74">&#34;eName&#34;</span> <span style="color:#66d9ef">FROM</span> t_emp;

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">表名</span> <span style="color:#960050;background-color:#1e0010">别名</span>
<span style="color:#66d9ef">SELECT</span> emp_name <span style="color:#66d9ef">FROM</span> t_emp emp;
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">如果给表起了别名，在</span>SELECT和WHERE中必须使用别名<span style="color:#960050;background-color:#1e0010">，否则会报错</span>
</code></pre></div><h4 id="去重">去重</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">只保留一个符合条件的结果</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> emp_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;赵&#39;</span>
</code></pre></div><h4 id="着重号-">着重号 ``</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">当表名或字段名与关键字发生冲突时，使用</span> <span style="color:#f92672">``</span> <span style="color:#960050;background-color:#1e0010">来区分</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">order</span><span style="color:#f92672">`</span>
</code></pre></div><h4 id="查询常数">查询常数</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;字符串&#39;</span>, <span style="color:#ae81ff">123</span>, emp_name, age <span style="color:#66d9ef">FROM</span> t_emp
</code></pre></div><p><img src="/imgs/QueryConst.png" alt="QueryConst"></p>
<h4 id="显示表结构">显示表结构</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DESC</span> t_emp
<span style="color:#66d9ef">DESCRIBE</span> t_emp
</code></pre></div><p><img src="/imgs/DESC.png" alt="DESC"></p>
<hr>
<hr>
<p><a id="op">#</a></p>
<h3 id="运算符---符号">运算符 - 符号</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;1&#39;</span>
<span style="color:#ae81ff">101</span>
<span style="color:#f92672">#</span> sql中<span style="color:#960050;background-color:#1e0010">，</span><span style="color:#f92672">+</span> <span style="color:#960050;background-color:#1e0010">没有连接的作用，会将字符串转换成数值（隐式转换）</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">不能被转换成数字的字符串（比如</span> <span style="color:#e6db74">&#39;abc&#39;</span><span style="color:#960050;background-color:#1e0010">）会被当成</span> <span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">看待</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;a&#39;</span>
<span style="color:#ae81ff">1</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">有</span> <span style="color:#66d9ef">null</span> <span style="color:#960050;background-color:#1e0010">参与的运算，结果为</span> <span style="color:#66d9ef">null</span>
</code></pre></div><p>关于除法</p>
<p>/ 结果默认浮点型，div 结果会自动取整</p>
<ul>
<li>&lt;=&gt; ：安全等于。与 = 作用相似，唯一区别是安全等于可以用来对 null 进行判断。两个操作数均为 null 时返回 1，一个操作数为 null 时返回 0。</li>
<li>&lt;&gt; != ：不等于</li>
</ul>
<h3 id="运算符---关键字">运算符 - 关键字</h3>
<h4 id="is-null--is-not-null--isnull函数">IS NULL \ IS NOT NULL \ ISNULL(函数)</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span> <span style="color:#960050;background-color:#1e0010">\</span> <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#960050;background-color:#1e0010">\</span> <span style="color:#66d9ef">ISNULL</span>(<span style="color:#960050;background-color:#1e0010">函数</span>)
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> email <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> email <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">ISNULL</span>(email)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">下面两个等价</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> email <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> email <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#66d9ef">NULL</span>

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">下面两个等价</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> email <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> email <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#66d9ef">NULL</span>

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">判断字段是否为空建议使用关键字</span> <span style="color:#960050;background-color:#1e0010">判断常量建议使用</span> <span style="color:#f92672">&lt;=&gt;</span>
</code></pre></div><h4 id="least-greatest">LEAST GREATEST</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> LEAST(, , , ) GREATEST(, , , ) <span style="color:#66d9ef">FROM</span> DUAL
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回括号中的最小</span>(<span style="color:#960050;background-color:#1e0010">最大</span>)<span style="color:#960050;background-color:#1e0010">值</span>
</code></pre></div><h4 id="between--and">BETWEEN &hellip; AND</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">WHERE</span> age <span style="color:#66d9ef">BETWEEN</span> <span style="color:#ae81ff">20</span> <span style="color:#66d9ef">AND</span> <span style="color:#ae81ff">40</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">包括边界，闭区间</span> <span style="color:#960050;background-color:#1e0010">，前后顺序不能反</span>
</code></pre></div><h4 id="like">LIKE</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">模糊查找，忽略大小写</span>
<span style="color:#66d9ef">SELECT</span> emp_name <span style="color:#66d9ef">WHERE</span> emp_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%a%&#39;</span> <span style="color:#66d9ef">FROM</span> t_emp
<span style="color:#f92672">#</span> <span style="color:#f92672">%</span> <span style="color:#960050;background-color:#1e0010">代表不确定个数的字符，包括</span> <span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">个（查找含</span> a <span style="color:#960050;background-color:#1e0010">的</span> emp_name<span style="color:#960050;background-color:#1e0010">）</span>

<span style="color:#66d9ef">SELECT</span> emp_name <span style="color:#66d9ef">WHERE</span> emp_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;_a%&#39;</span> <span style="color:#66d9ef">FROM</span> t_emp
<span style="color:#f92672">#</span> _ <span style="color:#960050;background-color:#1e0010">代表一个任意字符（查找第二个字符是</span> a <span style="color:#960050;background-color:#1e0010">的</span> emp_name<span style="color:#960050;background-color:#1e0010">）</span>
</code></pre></div><h4 id="正则表达式-regexprlike">正则表达式 REGEXP，RLIKE</h4>
<ul>
<li>^ 匹配以该字符后面的字符开头的字符串</li>
<li>$ 匹配以该字符前面的字符结尾的字符串</li>
<li>. 匹配任何一个单字符</li>
<li>[&hellip;] 匹配在方括号内的任何字符</li>
<li>[a-z] 匹配任何字母，[0-9] 匹配任何数字</li>
<li>* 匹配零个或多个在它前面的字符，例如[0-9]*，表示匹配任何数量的数字，单独使用表示匹配任何数量的字符串</li>
</ul>
<hr>
<hr>
<p><a id="ORDERBY">#</a></p>
<h3 id="order-by">ORDER BY</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">年龄增序</span> <span style="color:#960050;background-color:#1e0010">默认增序</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> age <span style="color:#66d9ef">ASC</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">年龄降序</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> age <span style="color:#66d9ef">DESC</span>
</code></pre></div><p>可以对别名进行排序</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> emp_name, salary, salary <span style="color:#f92672">*</span> <span style="color:#ae81ff">12</span> (annual_salary) <span style="color:#66d9ef">FROM</span> t_emp
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> annual_salary <span style="color:#66d9ef">DESC</span>
</code></pre></div><ul>
<li>列的别名只能在 ORDER BY 中使用，不能在 WHERE 中使用</li>
<li>ORDER BY 可以对未被查询(SELECT)的字段进行排序</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">语句执行顺序</span>
<span style="color:#66d9ef">SELECT</span> emp_name, salary, email 
<span style="color:#66d9ef">FROM</span> t_emp
<span style="color:#66d9ef">WHERE</span> age <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">30</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> age <span style="color:#66d9ef">ASC</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">首先根据</span>FROM找到要查询的表
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">再根据</span>WHERE筛选过滤
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">再看</span>SELECT后面要查询的字段<span style="color:#960050;background-color:#1e0010">，以及别名</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">最后进行排序</span>
<span style="color:#f92672">#</span> WHERE在SELECT之前执行<span style="color:#960050;background-color:#1e0010">，在此时还没有给字段赋予别名，所以无法使用别名</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">在</span>SELECT之后执行的语句可以使用别名<span style="color:#960050;background-color:#1e0010">，因此</span><span style="color:#66d9ef">ORDER</span> BY可以使用别名
</code></pre></div><h4 id="二级排序">二级排序</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">现根据字段一排序，字段一有重复一样的值，再按照字段二排序</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> t_emp 
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> age <span style="color:#66d9ef">ASC</span>,salary <span style="color:#66d9ef">DESC</span>
</code></pre></div><hr>
<hr>
<p><a id="PageSplit">#</a></p>
<h3 id="分页">分页</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#66d9ef">LIMIT</span> <span style="color:#66d9ef">offset</span>,pageSize
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> t_emp
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">20</span> <span style="color:#f92672">#</span> <span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">是偏移量，</span><span style="color:#ae81ff">20</span> <span style="color:#960050;background-color:#1e0010">是显示条目数</span> <span style="color:#960050;background-color:#1e0010">这是第一页</span>(<span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">可以省略</span>)
<span style="color:#f92672">#</span> <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">20</span> <span style="color:#960050;background-color:#1e0010">这是第二页，从第</span> <span style="color:#ae81ff">21</span> <span style="color:#960050;background-color:#1e0010">条数据开始展示</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">要展示第</span> n <span style="color:#960050;background-color:#1e0010">页的数据，</span><span style="color:#66d9ef">offset</span> <span style="color:#f92672">=</span> (n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> pageSize
</code></pre></div><hr>
<hr>
<p><a id="MultiTableQuery">#</a></p>
<h3 id="多表查询">多表查询</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> SQL92语法
<span style="color:#66d9ef">SELECT</span> employee_id,department_name
<span style="color:#66d9ef">FROM</span> employees,departments
<span style="color:#66d9ef">WHERE</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id

<span style="color:#f92672">#</span> SQL99语法
<span style="color:#66d9ef">SELECT</span> employee_id,department_name
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id

<span style="color:#f92672">#</span> SQL92语法
<span style="color:#66d9ef">SELECT</span> table1.<span style="color:#66d9ef">column</span>, table2.<span style="color:#66d9ef">column</span>
<span style="color:#66d9ef">FROM</span> table1, table2
<span style="color:#66d9ef">WHERE</span> table1.column1 <span style="color:#f92672">=</span> table1.column2

<span style="color:#f92672">#</span> SQL99语法
<span style="color:#66d9ef">SELECT</span> table1.<span style="color:#66d9ef">column</span>, table2.<span style="color:#66d9ef">column</span>, table3.<span style="color:#66d9ef">column</span>
<span style="color:#66d9ef">FROM</span> table1 
<span style="color:#66d9ef">JOIN</span> table2 <span style="color:#66d9ef">ON</span> table1.column1 <span style="color:#f92672">=</span> table2.column2
<span style="color:#66d9ef">JOIN</span> table3 <span style="color:#66d9ef">ON</span> table2.column3 <span style="color:#f92672">=</span> table3.column4
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">从</span> <span style="color:#66d9ef">sql</span> <span style="color:#960050;background-color:#1e0010">优化的角度，建议多表查询时，每个字段前都加上对应的表名</span>
</code></pre></div><p><em><strong>如果有n个表实现多表查询，需要至少n-1个连接条件</strong></em></p>
<h4 id="多表查询的分类---不同角度">多表查询的分类 - 不同角度</h4>
<ul>
<li>
<p>等值连接 、非等值连接</p>
<ul>
<li>
<p>等值连接：上</p>
</li>
<li>
<p>非等值连接</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> SQL92
<span style="color:#66d9ef">SELECT</span> name,salary,grade_level
<span style="color:#66d9ef">FROM</span> employees e,job_grades j
<span style="color:#66d9ef">WHERE</span> e.salary <span style="color:#66d9ef">BETWEEN</span> j.lowest_sal <span style="color:#66d9ef">AND</span> j.highest_sal
    
<span style="color:#f92672">#</span> SQL99
<span style="color:#66d9ef">SELECT</span> name,salary,grade_level
<span style="color:#66d9ef">FROM</span> employees e 
<span style="color:#66d9ef">JOIN</span> job_grades j <span style="color:#66d9ef">ON</span> e.salary <span style="color:#66d9ef">BETWEEN</span> j.lowest_sal <span style="color:#66d9ef">AND</span> j.highest_sal
</code></pre></div></li>
</ul>
</li>
<li>
<p>自连接 、 非自连接</p>
<p>自我引用：</p>
<p><img src="/imgs/SelfRef.png" alt="SelfRef"></p>
<ul>
<li>
<p>自连接(给同一张表起不同的别名，逻辑上看成两张表)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> SQL92
<span style="color:#66d9ef">SELECT</span> emp.emp_id,emp.emp_name,mng.emp_id,mng.emp_name
<span style="color:#66d9ef">FROM</span> employees emp,employees mng
<span style="color:#66d9ef">WHERE</span> emp.manager_id <span style="color:#f92672">=</span> mng.emp_id
    
<span style="color:#f92672">#</span> SQL99
<span style="color:#66d9ef">SELECT</span> emp.emp_id,emp.emp_name,mng.emp_id,mng.emp_name
<span style="color:#66d9ef">FROM</span> employees emp 
<span style="color:#66d9ef">JOIN</span> employees mng <span style="color:#66d9ef">ON</span> emp.manager_id <span style="color:#f92672">=</span> mng.emp_id
</code></pre></div></li>
</ul>
</li>
<li>
<p>内连接 、 外连接</p>
<ul>
<li>
<p>以上全是内连接：合并具有同一列的两个以上的表的行，结果集中不包含一个表与另一个表不匹配的行</p>
</li>
<li>
<p>外连接：两个表在连接过程中除了返回满足连接条件的行以外还返回左或右表中不满足条件的行，称为左/右外连接</p>
<ul>
<li>如果是左外连接，连接表中左表为主表，右表为从表</li>
<li>如果是右外连接，连接表中右表为主表，左表为从表</li>
</ul>
<p><strong>SQL99语法使用JOIN &hellip; ON 的方式实现多表查询外连接</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> SQL99语法 <span style="color:#960050;background-color:#1e0010">左外连接</span> OUTER可以省略
<span style="color:#66d9ef">SELECT</span> employee_id,department_name
<span style="color:#66d9ef">FROM</span> employees 
<span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">OUTER</span> <span style="color:#66d9ef">JOIN</span> departments <span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
    
<span style="color:#f92672">#</span> SQL99语法 <span style="color:#960050;background-color:#1e0010">右外连接</span> OUTER可以省略
<span style="color:#66d9ef">SELECT</span> employee_id,department_name
<span style="color:#66d9ef">FROM</span> employees 
<span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">OUTER</span> <span style="color:#66d9ef">JOIN</span> departments <span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
    
<span style="color:#f92672">#</span> SQL99语法 <span style="color:#960050;background-color:#1e0010">满</span>(<span style="color:#960050;background-color:#1e0010">全</span>)<span style="color:#960050;background-color:#1e0010">外连接</span> OUTER可以省略
<span style="color:#f92672">#</span> MySQL不支持FULL <span style="color:#66d9ef">OUTER</span> JOIN写法
<span style="color:#f92672">#</span> Oracle支持FULL <span style="color:#66d9ef">OUTER</span> JOIN写法
<span style="color:#66d9ef">SELECT</span> employee_id,department_name
<span style="color:#66d9ef">FROM</span> employees 
<span style="color:#66d9ef">FULL</span> <span style="color:#66d9ef">OUTER</span> <span style="color:#66d9ef">JOIN</span> departments <span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
</code></pre></div></li>
</ul>
</li>
</ul>
<p><img src="/imgs/SQLJoin.png" alt="SQLJoin"></p>
<h4 id="union">UNION</h4>
<p>利用UNION关键字，可以给出多条SELECT语句，并将他们的结果组合成单个结果集。合并时，两个表对应的列数和数据类型必须相同，并相互对应。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#66d9ef">UNION</span> <span style="color:#960050;background-color:#1e0010">去重，</span><span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span> <span style="color:#960050;background-color:#1e0010">不去重</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">column</span>,... <span style="color:#66d9ef">FROM</span> table1
<span style="color:#66d9ef">UNION</span> [<span style="color:#66d9ef">ALL</span>]
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">column</span>,... <span style="color:#66d9ef">FROM</span> table2
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">如果明确知道合并后数据不会重复，应使用</span> <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">执行</span> <span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span> <span style="color:#960050;background-color:#1e0010">语句时所需要的资源比</span> <span style="color:#66d9ef">UNION</span> <span style="color:#960050;background-color:#1e0010">少</span>
</code></pre></div><h4 id="使用union可以在mysql中实现满外连接">使用UNION可以在MySQL中实现满外连接</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#66d9ef">SQL</span> Joins左上图
<span style="color:#66d9ef">SELECT</span> emp_id,department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">UNION</span> <span style="color:#66d9ef">ALL</span>
<span style="color:#f92672">#</span> <span style="color:#66d9ef">SQl</span> Joins右中图
<span style="color:#66d9ef">SELECT</span> emp_id,department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">WHERE</span> e.department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>
</code></pre></div><hr>
<hr>
<p><a id="SQL99newFeature">#</a></p>
<h3 id="sql99新特性">SQL99新特性</h3>
<h4 id="自然连接">自然连接</h4>
<p>SQL99语法新特性，可以理解为SQL92中的等值连接，自动查询两张表中<strong>所有相同的字段</strong>（相同字段名），然后进行等值连接</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> SQL92
<span style="color:#66d9ef">SELECT</span> employee_id,last_name,department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">AND</span> e.manager_id <span style="color:#f92672">=</span> d.manager_id

<span style="color:#f92672">#</span>SQL99
<span style="color:#66d9ef">SELECT</span> employee_id,last_name,department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">NATURAL</span> <span style="color:#66d9ef">JOIN</span> departments d
</code></pre></div><h4 id="using">USING</h4>
<p><strong>指定</strong>两张连接表中<strong>相同的字段</strong>，进行等值连接</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> SQL92
<span style="color:#66d9ef">SELECT</span> employee_id,last_name,department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id

<span style="color:#f92672">#</span> SQL99
<span style="color:#66d9ef">SELECT</span> employee_id,last_name,department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">USING</span> (department_id)
</code></pre></div><hr>
<hr>
<p><a id="SingleLineFunction">#</a></p>
<h3 id="单行函数">单行函数</h3>
<p><em><strong>不同的DBMS对于函数的支持不同，差异很大，使用函数的SQL代码移植性很差</strong></em></p>
<p>单行函数：单行输入，单行输出</p>
<ul>
<li>操作数据对象</li>
<li>可以嵌套</li>
<li>参数可以是一列或一个值</li>
</ul>
<hr>
<h4 id="数值函数">数值函数</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">ABS</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">123</span>),<span style="color:#66d9ef">ABS</span>(<span style="color:#ae81ff">123</span>),SIGN(<span style="color:#f92672">-</span><span style="color:#ae81ff">123</span>),SIGN(<span style="color:#ae81ff">123</span>),PI(),CEIL(<span style="color:#ae81ff">32</span>.<span style="color:#ae81ff">32</span>),CEILING(<span style="color:#f92672">-</span><span style="color:#ae81ff">43</span>.<span style="color:#ae81ff">23</span>),FLOOR(<span style="color:#ae81ff">32</span>.<span style="color:#ae81ff">32</span>),
FLOOR(<span style="color:#f92672">-</span><span style="color:#ae81ff">43</span>.<span style="color:#ae81ff">23</span>),<span style="color:#66d9ef">MOD</span>(<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">5</span>)
<span style="color:#66d9ef">FROM</span> DUAL;
</code></pre></div><p><img src="/imgs/SingleLineFunction.png" alt="SingleLineFunction"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">RAND() <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">随机数，伪随机，结果</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">~</span> <span style="color:#ae81ff">1</span>
RAND(x) <span style="color:#f92672">#</span> x作为种子<span style="color:#960050;background-color:#1e0010">，种子相同，随机数结果也相同</span>
ROUND(x) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">取整，四舍五入</span>
ROUND(x, y) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">取证，保留</span>y位小数<span style="color:#960050;background-color:#1e0010">，</span>y可为负数<span style="color:#960050;background-color:#1e0010">，以小数点为标准</span>
<span style="color:#66d9ef">TRUNCATE</span>(x, y) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">截断，不进位，直接截断至小数点后</span>y位
SQRT(x) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">开方</span>
POW(x, y) <span style="color:#f92672">|</span> POWER(x, y) <span style="color:#f92672">#</span> x的y次方
EXP(x) <span style="color:#f92672">#</span> e的x次方
LN(x) <span style="color:#f92672">|</span> LOG(x) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回以</span>e为底x的对数
LOG10(x), LOG2(x) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">略</span>
BIN(x), HEX(x), OCT(x) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">进制转换</span>
CONV(x, f1, f2) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">将</span>f1进制的x转换为f2进制
</code></pre></div><hr>
<h4 id="字符串函数">字符串函数</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">ASCII(s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回字符串</span>s中第一个字符的ASCII码值

<span style="color:#66d9ef">CHAR_LENGTH</span>(s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回字符串</span>s的字符数

<span style="color:#66d9ef">LENGTH</span>(s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回字符串</span>s的字节数<span style="color:#960050;background-color:#1e0010">，和字符集有关</span>

CONCAT(s1,s2,s3...sn) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">连接字符串</span>

CONCAT_WS(x,s1,s2,s3...sn) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">连接字符串，每个字符串之间要加上</span>x

<span style="color:#66d9ef">INSERT</span>(str,idx,len,replacestr) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">将字符串</span>str从第idx位置开始<span style="color:#960050;background-color:#1e0010">，</span>len个字符长的字串替换为字符串replacestr

<span style="color:#66d9ef">REPLACE</span>(str,a,b) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">用字符</span>b替换所有在str中出现的字符a

<span style="color:#66d9ef">UPPER</span>(s) <span style="color:#f92672">|</span> UCASE(s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">转大写</span>

<span style="color:#66d9ef">LOWER</span>(s) <span style="color:#f92672">|</span> LCASE(s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">转小写</span>

<span style="color:#66d9ef">LEFT</span>(str,n) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回字符串</span>str最左边n个字符

<span style="color:#66d9ef">RIGHT</span>(str,n) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回字符串</span>str最右边n个字符

LPAD(str,len,<span style="color:#66d9ef">pad</span>) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">用字符串</span>pad对str最左边进行填充<span style="color:#960050;background-color:#1e0010">，直到</span>str的长度为len个字符 <span style="color:#960050;background-color:#1e0010">可用来对齐</span>

RPAD(str,len,<span style="color:#66d9ef">pad</span>) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">用字符串</span>pad对str最右边进行填充<span style="color:#960050;background-color:#1e0010">，直到</span>str的长度为len个字符 <span style="color:#960050;background-color:#1e0010">可用来对齐</span>

LTRIM(s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">去掉字符串</span>s左侧的空格

RTRIM(s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">去掉字符串</span>s右侧的空格

<span style="color:#66d9ef">TRIM</span>(s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">去掉字符串</span>s开始与结尾的空格

<span style="color:#66d9ef">TRIM</span>(s1 <span style="color:#66d9ef">FROM</span> s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">去掉字符串</span>s开始与结尾的s1

<span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">LEADING</span> s1 <span style="color:#66d9ef">FROM</span> s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">去掉字符串</span>s开始的s1

<span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">TRAILING</span> s1 <span style="color:#66d9ef">FROM</span> s) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">去掉字符串</span>s结尾的s1

REPEAT(str,n) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回</span>str重复n次的结果

<span style="color:#66d9ef">SPACE</span>(n) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回</span>n个空格

STRCMP(s1,s2) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">比较字符串</span>s1与s2的ASCII码值的大小

SUBSTR(s,<span style="color:#66d9ef">index</span>,len) <span style="color:#f92672">|</span> <span style="color:#66d9ef">SUBSTRING</span>(s,<span style="color:#66d9ef">index</span>,len) <span style="color:#f92672">|</span> MID(s,n,len) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回从</span>index起len个字符

LOCATE(substr,str) <span style="color:#f92672">|</span> <span style="color:#66d9ef">POSITION</span>(substr <span style="color:#66d9ef">IN</span> str) <span style="color:#f92672">|</span> INSTR(str,substr) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回字符串</span>substr在字符串str中首次出现的位置

ELT(m,s1,s2...sn) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回指定位置的字符串，如果</span>m<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">，则返回</span>s1<span style="color:#960050;background-color:#1e0010">，如果</span>m<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">，则返回</span>s2<span style="color:#960050;background-color:#1e0010">，如果</span>m<span style="color:#f92672">=</span>n<span style="color:#960050;background-color:#1e0010">，则返回</span>sn

FIELD(s,s1,s2...sn) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回字符串</span>s在字符串列表中第一次出现的位置

FIND_IN_SET(s1,s2) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回字符串</span>s1在字符串s2中第一次出现的位置<span style="color:#960050;background-color:#1e0010">。其中，字符串</span>s2是一个以逗号分隔的字符串

<span style="color:#66d9ef">SELECT</span> FIND_IN_SET(<span style="color:#e6db74">&#39;abc&#39;</span>, <span style="color:#e6db74">&#39;fsdf,abc,asgw,abc&#39;</span>)
<span style="color:#66d9ef">FROM</span> DUAL; <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">结果</span> <span style="color:#ae81ff">2</span>
</code></pre></div><hr>
<h4 id="日期和时间函数">日期和时间函数</h4>
<h5 id="获取日期时间">获取日期、时间</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">CURDATE(), <span style="color:#66d9ef">CURRENT_DATE</span>() <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回当前日期，只包含年月日</span>

CURTIME(), <span style="color:#66d9ef">CURRENT_TIME</span>() <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回当前时间，只包含时分秒</span>

NOW()<span style="color:#f92672">/</span>SYSDATE()<span style="color:#f92672">/</span><span style="color:#66d9ef">CURRENT_TIMESTAMP</span>()<span style="color:#f92672">/</span><span style="color:#66d9ef">LOCALTIME</span>()<span style="color:#f92672">/</span><span style="color:#66d9ef">LOCALTIMESTAMP</span>() <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回当前系统日期和时间</span>

UTC_DATE() <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回</span>UTC<span style="color:#960050;background-color:#1e0010">（世界标准时间）日期</span>

UTC_TIME() <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回</span>UTC<span style="color:#960050;background-color:#1e0010">（世界标准时间）时间</span>

<span style="color:#66d9ef">SELECT</span> CURDATE(), CURTIME(), NOW(), SYSDATE(), UTC_DATE(), UTC_TIME(), UTC_DATE()<span style="color:#f92672">+</span><span style="color:#ae81ff">0</span>, UTC_TIME()<span style="color:#f92672">+</span><span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">FROM</span> DUAL;
</code></pre></div><p><img src="/imgs/TimeSQL.png" alt="TimeSQL"></p>
<h5 id="日期与时间戳的转换">日期与时间戳的转换</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">UNIX_TIMESTAMP() <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">以</span>UNIX时间戳的形式返回当前时间<span style="color:#960050;background-color:#1e0010">。</span>
<span style="color:#66d9ef">SELECT</span> UNIX_TIMESTAMP(); <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">结果：</span><span style="color:#ae81ff">1677209647</span>

UNIX_TIMESTAMP(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">将时间</span>date以UNIX时间戳的形式返回

FROM_UNIXTIME(<span style="color:#66d9ef">timestamp</span>) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">将</span>UNIX时间戳的时间转换为普通格式的时间
</code></pre></div><h5 id="获取月份星期星期数天数等函数">获取月份、星期、星期数、天数等函数</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">YEAR</span>(date)<span style="color:#f92672">/</span><span style="color:#66d9ef">MONTH</span>(date)<span style="color:#f92672">/</span><span style="color:#66d9ef">DAY</span>(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回具体的日期值</span>

HOUR(time)<span style="color:#f92672">/</span><span style="color:#66d9ef">MINUTE</span>(time)<span style="color:#f92672">/</span><span style="color:#66d9ef">SECOND</span>(time) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回具体的时间值</span>

MONTHNAME(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回月份：</span>January, ...

DAYNAME(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回星期几：</span>MONDAY, TUESDAY

WEEKDAY(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回周几，周一</span><span style="color:#ae81ff">0</span>, <span style="color:#960050;background-color:#1e0010">周二</span><span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">依此类推</span>

QUARTER(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回日期对应的季度</span> <span style="color:#960050;background-color:#1e0010">范围</span><span style="color:#ae81ff">1</span><span style="color:#f92672">~</span><span style="color:#ae81ff">4</span>

WEEK(date) <span style="color:#f92672">|</span> WEEKOFYEAR(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回一年中第几周</span>

DAYOFYEAR(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回日期是一年中第几天</span>

DAYOFMONTH(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回日期位于所在月份的第几天</span>

DAYOFWEEK(date) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">返回周几</span> <span style="color:#960050;background-color:#1e0010">周日</span><span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">周一</span><span style="color:#ae81ff">2</span> <span style="color:#960050;background-color:#1e0010">以此类推，与</span>WEEKDAY区分
</code></pre></div><h5 id="日期的操作函数">日期的操作函数</h5>
<p>略</p>
<h5 id="日期格式化">日期格式化</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">DATE_FORMAT(date,fmt) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">按照字符串</span>fmt格式化日期date值
TIME_FORMAT(time,fmt) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">按照字符串</span>fmt格式化时间time值

<span style="color:#f92672">#</span> <span style="color:#f92672">%</span>Y <span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">位数字表示年份</span>		<span style="color:#f92672">%</span>y <span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">位数字表示年份</span>
<span style="color:#f92672">#</span> <span style="color:#f92672">%</span>M <span style="color:#960050;background-color:#1e0010">月名表示月份</span>			<span style="color:#f92672">%</span>m <span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">位数字表示月份</span>
<span style="color:#f92672">#</span> <span style="color:#f92672">%</span>b <span style="color:#960050;background-color:#1e0010">缩写月名表示月份</span>		<span style="color:#f92672">%</span><span style="color:#66d9ef">c</span> <span style="color:#960050;background-color:#1e0010">数字表示月份</span>
<span style="color:#f92672">#</span> <span style="color:#f92672">%</span>D <span style="color:#960050;background-color:#1e0010">英文后缀表示月中的天数</span>(<span style="color:#ae81ff">1</span>st,<span style="color:#ae81ff">2</span>nd...)		<span style="color:#f92672">%</span>d <span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">位数字表示月中的天数</span>(<span style="color:#ae81ff">01</span>,<span style="color:#ae81ff">02</span>,<span style="color:#ae81ff">03</span>....)
<span style="color:#f92672">#</span> <span style="color:#f92672">%</span>e <span style="color:#960050;background-color:#1e0010">数字形式表示月中的天数</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>...)

<span style="color:#66d9ef">SELECT</span> DATE_FORMAT(CURDATE(), <span style="color:#e6db74">&#39;%Y-%M-%D&#39;</span>),DATE_FORMAT(NOW(), <span style="color:#e6db74">&#39;%Y-%m-%d&#39;</span>)
<span style="color:#66d9ef">FROM</span> DUAL;
</code></pre></div><p><img src="/imgs/DateFormat.png" alt="DateFormat"></p>
<hr>
<h4 id="流程控制函数">流程控制函数</h4>
<p>流程处理函数可以根据不同的条件，执行不同的处理流程，可以在SQL语句中实现不同的条件选择。MySQL中的流程处理函数主要包括IF()、IFNULL()和CASE()函数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">IF</span>(value,value1,value2) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">如果</span>value值为true<span style="color:#960050;background-color:#1e0010">，返回</span>value1<span style="color:#960050;background-color:#1e0010">，否则返回</span>value2

IFNULL(value1,value2) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">如果</span>value1不为NULL<span style="color:#960050;background-color:#1e0010">，返回</span>value1<span style="color:#960050;background-color:#1e0010">，否则返回</span>value2

<span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> condition1 <span style="color:#66d9ef">THEN</span> result1
<span style="color:#66d9ef">WHEN</span> condition2 <span style="color:#66d9ef">THEN</span> result2
[<span style="color:#66d9ef">ELSE</span> resultn] <span style="color:#66d9ef">END</span> <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">相当于</span>Java的if...<span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span>...<span style="color:#66d9ef">else</span>...

<span style="color:#66d9ef">CASE</span> expr <span style="color:#66d9ef">WHEN</span> const1 <span style="color:#66d9ef">THEN</span> value1
<span style="color:#66d9ef">WHEN</span> const2 <span style="color:#66d9ef">THEN</span> value2
[<span style="color:#66d9ef">ELSE</span> valuen] <span style="color:#66d9ef">END</span> <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">相当于</span>Java的switch...<span style="color:#66d9ef">case</span>...
</code></pre></div><hr>
<hr>
<p><a id="AggregateFunctions">#</a></p>
<h3 id="聚合函数与groupbyhaving">聚合函数与GROUPBY、HAVING</h3>
<p>聚合函数：多行输入，单行输出</p>
<p><em><strong>MySQL暂时不支持聚合函数嵌套</strong></em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">MIN</span>(<span style="color:#66d9ef">column</span>) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">求列中的最小值</span>
<span style="color:#66d9ef">MAX</span>(<span style="color:#66d9ef">column</span>) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">求列中的最大值</span>
<span style="color:#66d9ef">AVG</span>(<span style="color:#66d9ef">column</span>) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">平均值</span>
<span style="color:#66d9ef">SUM</span>(<span style="color:#66d9ef">column</span>) <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">求和</span>
</code></pre></div><hr>
<h4 id="group-by">GROUP BY</h4>
<p>分组关键字</p>
<p>SELECT中出现的非聚合函数的字段必须声明在GROUP BY中，否则会出现错误(确定不存在重复值的列可以除外)。GROUP BY中生命的字段可以不出现在SELECT中</p>
<p>GROUP BY &hellip; WITH ROLLUP 可额外求平均值</p>
<hr>
<h4 id="having">HAVING</h4>
<p>与WHERE类似，过滤条件，与GROUP BY配合使用</p>
<h5 id="having-与-where-异同">HAVING 与 WHERE 异同</h5>
<ul>
<li>都起过滤条件的作用，都可以使用表中的字段作为筛选条件</li>
<li>WHERE不能使用分组中的计算函数作为筛选条件，HAVING可以把分组计算的函数作为筛选条件</li>
<li>如果需要通过连接从关联表中获取需要的数据，WHERE是先筛选后连接，HAVING是先连接后筛选</li>
</ul>
<p><em><strong>我们可以在一个查询里同时使用WHERE和HAVING，包含分组统计函数的条件用HAVING，普通条件用WHERE</strong></em></p>
<hr>
<hr>
<p><a id="SQLexqtProcess">#</a></p>
<h3 id="sql执行流程">SQL执行流程</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> (<span style="color:#66d9ef">DISTINCT</span>) <span style="color:#f92672">#</span> <span style="color:#ae81ff">5</span>
<span style="color:#66d9ef">FROM</span> (<span style="color:#66d9ef">LEFT</span><span style="color:#f92672">/</span><span style="color:#66d9ef">RIGHT</span>) <span style="color:#66d9ef">JOIN</span> <span style="color:#66d9ef">ON</span> <span style="color:#f92672">#</span> <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">WHERE</span> <span style="color:#f92672">#</span> <span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#f92672">#</span> <span style="color:#ae81ff">3</span>
<span style="color:#66d9ef">HAVING</span> <span style="color:#f92672">#</span> <span style="color:#ae81ff">4</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#f92672">#</span> <span style="color:#ae81ff">6</span>
<span style="color:#66d9ef">LIMIT</span> <span style="color:#f92672">#</span> <span style="color:#ae81ff">7</span>
</code></pre></div><p>先执行FROM，如果是多表联查，还会有以下几个步骤</p>
<ol>
<li>首先通过CROSS JOIN求笛卡尔积，相当于得到虚拟表vt1-1</li>
<li>通过ON进行筛选，在虚拟表vt1-1基础上的得到vt1-2</li>
<li>添加外部行，得到vt1-3</li>
</ol>
<p>重复以上步骤直到所有表都被处理完为止，这个过程得到的是原始数据</p>
<p>当我们拿到了查询数据表的原始数据，也就是最终虚拟表vt1，就可以在此基础上在进行WHERE，在这个阶段中会根据vt1表的结果进行筛选过滤，得到虚拟表vt2</p>
<p>然后进入第三步和第四步，GROUPBY和HAVING，在vt2的基础上进行分组和分组过滤，得到vt3和vt4</p>
<p>当完成了条件筛选部分之后，就可以筛选表中提取的字段，SELECT和DISTINCT</p>
<p>提取到想要的字段数据后，可以按照指定字段进行排序ORDERBY，最后LIMIT取出指定行的记录</p>
<hr>
<hr>
<p><a id="SubQuery">#</a></p>
<h3 id="子查询嵌套查询">子查询(嵌套查询)</h3>
<p>子查询指一个查询语句嵌套在另一个查询语句内部的查询，这个特性从MySQL4.1开始引入</p>
<p>SQL中子查询的使用大大增强了SELECT查询的能力，因为很多时候查询需要从结果集中获取数据，或者需要从同一个表中先计算得出一个数据结果，然后根据这个数据结果(可能是某个标量，也可能是某个集合)进行比较</p>
<hr>
<h4 id="子查询的基本使用">子查询的基本使用</h4>
<ul>
<li>
<p>子查询的基本语法结构</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> select_list
<span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">table</span>
<span style="color:#66d9ef">WHERE</span> expr <span style="color:#66d9ef">operator</span>
              (<span style="color:#66d9ef">SELECT</span> select_list
                 <span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">table</span>);
</code></pre></div></li>
<li>
<p>子查询（内查询）在主查询之前一次执行完成</p>
</li>
<li>
<p>子查询的结果被主查询（外查询）使用</p>
</li>
<li>
<p>子查询要包含在括号内</p>
<ul>
<li>将子查询放在比较条件的右侧</li>
<li>单行操作符对应单行子查询，多行操作符对应多行子查询</li>
</ul>
</li>
</ul>
<hr>
<h4 id="子查询分类">子查询分类</h4>
<p>按内查询的结果返回一条还是多条记录，分为<em><strong>单行子查询</strong></em>、<em><strong>多行子查询</strong></em></p>
<p>按内查询是否被执行多次，分为<em><strong>相关(关联)子查询</strong></em>和<em><strong>不相关(非关联)子查询</strong></em></p>
<h4 id="单行子查询">单行子查询</h4>
<h5 id="单行比较操作符">单行比较操作符</h5>
<table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>=</td>
<td>等于</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&gt;=</td>
<td>大于等于</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>&lt;=</td>
<td>小于等于</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>不等于</td>
</tr>
</tbody>
</table>
<p>**例：**查询工资大于149号员工工资的员工信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> emp_name, emp_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> salary
                <span style="color:#66d9ef">FROM</span> employees
                <span style="color:#66d9ef">WHERE</span> emp_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">149</span>)
</code></pre></div><p>**例：**查询job_id与141号员工相同，salary比143号员工多的员工姓名，job_id和工资</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> emp_name,job_id,salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> job_id
                <span style="color:#66d9ef">FROM</span> employees
                <span style="color:#66d9ef">WHERE</span> emp_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">141</span>)
<span style="color:#66d9ef">AND</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> salary
              <span style="color:#66d9ef">FROM</span> employees
              <span style="color:#66d9ef">WHERE</span> emp_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">143</span>)
</code></pre></div><p>**例：**查询公司工资最少的员工的last_name,job_id,salary</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> last_name,job_id,salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MIN</span>(salary)
				<span style="color:#66d9ef">FROM</span> employees)
</code></pre></div><p>**例：**查询与141号或174号员工的manager_id和department_id相同的其他员工的emp_id,manager_id,department_id</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式一：</span>
<span style="color:#66d9ef">SELECT</span> emp_id,manager_id,department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> manager_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> manager_id
                    <span style="color:#66d9ef">FROM</span> employees
                    <span style="color:#66d9ef">WHERE</span> emp_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">174</span>))
<span style="color:#66d9ef">AND</span> department_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> department_id
                     <span style="color:#66d9ef">FROM</span> employees
                     <span style="color:#66d9ef">WHERE</span> emp_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">174</span>)))
<span style="color:#66d9ef">AND</span> emp_id <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">174</span>)

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式二：</span>
<span style="color:#66d9ef">SELECT</span> emp_id,manager_id,department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> (manager_id,department_id) <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> manager_id,department_id
                                    <span style="color:#66d9ef">FROM</span> employees
                                    <span style="color:#66d9ef">WHERE</span> emp_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">174</span>))
<span style="color:#66d9ef">AND</span> emp_id <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">141</span>,<span style="color:#ae81ff">174</span>)

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">两方式效率大差不差，方式二写代码更少，方式一适用范围更广</span>
</code></pre></div><p>子查询的结果为空值时不会报错，不返回任何行</p>
<h5 id="非法使用子查询">非法使用子查询</h5>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> emp_id,last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MIN</span>(salary)
                <span style="color:#66d9ef">FROM</span> employees
                <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id)
                
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">子查询返回的结果是多行数据，此时应使用</span> <span style="color:#66d9ef">IN</span> <span style="color:#960050;background-color:#1e0010">而非</span> <span style="color:#f92672">=</span>
</code></pre></div><hr>
<h4 id="多行子查询">多行子查询</h4>
<ul>
<li>也称为集合比较子查询</li>
<li>内查询返回多行</li>
<li>使用多行比较操作符</li>
</ul>
<table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>IN</td>
<td>等于列表中的任意一个</td>
</tr>
<tr>
<td>ANY</td>
<td>需要和单行比较操作符一起使用，和子查询返回的<strong>某一个</strong>值比较</td>
</tr>
<tr>
<td>ALL</td>
<td>需要和单行比较操作符一起使用，和子查询返回的<strong>所有</strong>值比较</td>
</tr>
<tr>
<td>SOME</td>
<td>ANY的别名，作用相同，一般常使用ANY</td>
</tr>
</tbody>
</table>
<p>**例：**查询其他job_id中比job_id为&rsquo;IT_PROG&rsquo;部门任一工资低的员工的员工号，姓名，job_id，以及salary</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> emp_id,emp_name,job_id,salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">&lt;&gt;</span> <span style="color:#e6db74">&#39;IT_PROG&#39;</span>,
salary <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">ANY</span> (<span style="color:#66d9ef">SELECT</span> salary
              <span style="color:#66d9ef">FROM</span> employees
              <span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;IT_PROG&#39;</span>)
</code></pre></div><hr>
<h4 id="相关子查询">相关子查询</h4>
<p>如果子查询的执行依赖于外部查询，通常情况下都是因为子查询中的表用到了外部的表，并进行了条件关联，因此每执行一次外部查询，子查询都要重新计算一次，这样的子查询就称之为<em><strong>关联子查询</strong></em></p>
<p>相关子查询按照一行接一行的顺序执行，主查询的每一行都执行一次子查询</p>
<p><img src="/imgs/RelativeSQ.png" alt="RelativeSQ"></p>
<p>**例：**查询员工中工资大于本部门平均工资的员工的name，salary，department_id</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> emp_name,salary,department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">outer</span>
<span style="color:#66d9ef">where</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
                <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">inner</span>
                <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                <span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">inner</span>.department_id <span style="color:#f92672">=</span> <span style="color:#66d9ef">outer</span>.department_id
               )
</code></pre></div><p>**例：**查询员工的id，salary（employees表中），按照department_name（departments表中）排序</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> emp_id,salary
<span style="color:#66d9ef">FROM</span> employees e
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> (<span style="color:#66d9ef">SELECT</span> department_name
          <span style="color:#66d9ef">FROM</span> departments d
          <span style="color:#66d9ef">WHERE</span> e.department_id <span style="color:#f92672">=</span> d.department_id
         )
</code></pre></div><p>**例：**若employees表中emp_id与 job_history表中emp_id相同的数目不小于2，输出这些相同id的员工的emp_id，last_name和job_id</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> emp_id,last_name,job_id
<span style="color:#66d9ef">FROM</span> employees e
<span style="color:#66d9ef">WHERE</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">&lt;=</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>)
           <span style="color:#66d9ef">FROM</span> job_history j
           <span style="color:#66d9ef">WHERE</span> e.employee_id <span style="color:#f92672">=</span> j.employee_id
          )
</code></pre></div><p>结论：在SELECT语句中，除了ORDER BY和LIMIT之外，都可以写子查询</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> (<span style="color:#66d9ef">DISTINCT</span>)
<span style="color:#66d9ef">FROM</span> (<span style="color:#66d9ef">LEFT</span><span style="color:#f92672">/</span><span style="color:#66d9ef">RIGHT</span>) <span style="color:#66d9ef">JOIN</span> <span style="color:#66d9ef">ON</span>
<span style="color:#66d9ef">WHERE</span>
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span>
<span style="color:#66d9ef">HAVING</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#f92672">#</span> 
<span style="color:#66d9ef">LIMIT</span> <span style="color:#f92672">#</span> 
</code></pre></div><h4 id="exists-与-not-exists关键字">EXISTS 与 NOT EXISTS关键字</h4>
<p>**例：**查询公司管理者的emp_id,last_name,job_id,department_id信息</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式一：自连接</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> mgr.emp_id,mgr.last_name,mgr.job_id,mgr.department_id
<span style="color:#66d9ef">FROM</span> employees emp <span style="color:#66d9ef">JOIN</span> employees mgr
<span style="color:#66d9ef">ON</span> emp.manager_id <span style="color:#f92672">=</span> mgr.emp_id

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式二：子查询</span>
<span style="color:#66d9ef">SELECT</span> emp_id,last_name,job_id,department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> emp_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> manager_id
                 <span style="color:#66d9ef">FROM</span> employees
                )

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式三：</span>EXISTS关键字
<span style="color:#66d9ef">SELECT</span> emp_id,last_name,job_id,department_id
<span style="color:#66d9ef">FROM</span> employees e1
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">EXISTS</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
              <span style="color:#66d9ef">FROM</span> employees e2
              <span style="color:#66d9ef">WHERE</span> e1.emp_id <span style="color:#f92672">=</span> e2.manager_id
             )
</code></pre></div><p>**例：**查询departments表中，不存在于employees表中的部门的depaertment_id和department_name</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式一：右外连接</span>
<span style="color:#66d9ef">SELECT</span> d.department_id,d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">WHERE</span> e.department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式二：</span><span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span>
<span style="color:#66d9ef">SELECT</span> department_id,department_name
<span style="color:#66d9ef">FROM</span> departments d
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
                 <span style="color:#66d9ef">FROM</span> employees
                 <span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> e.department_id
                 )
</code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
